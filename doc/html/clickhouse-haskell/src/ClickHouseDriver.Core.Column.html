<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE BlockArguments #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-comment">-- | This module contains the implementations of</span><span>
</span><a name="line-9"></a><span class="hs-comment">--   serialization and deserialization of Clickhouse data types.</span><span>
</span><a name="line-10"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">ClickHouseDriver.Core.Column</span><span>
</span><a name="line-11"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-comment">-- * Serialize and deserialize</span><span>
</span><a name="line-12"></a><span>    </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>    </span><a href="ClickHouseDriver.Core.Column.html#readColumn"><span class="hs-identifier hs-var">readColumn</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>    </span><a href="ClickHouseDriver.Core.Column.html#writeColumn"><span class="hs-identifier hs-var">writeColumn</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span>    </span><span class="hs-comment">-- * Operations on ClickhouseType</span><span>
</span><a name="line-17"></a><span>    </span><a href="ClickHouseDriver.Core.Column.html#transpose"><span class="hs-identifier hs-var">transpose</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>    </span><a href="ClickHouseDriver.Core.Column.html#putStrLn"><span class="hs-identifier hs-var">ClickHouseDriver.Core.Column.putStrLn</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span class="hs-keyword">where</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><a href="ClickHouseDriver.Core.Types.html"><span class="hs-identifier">ClickHouseDriver.Core.Types</span></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="ClickHouseDriver.Core.Types.html#Context"><span class="hs-identifier hs-type">Context</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ServerInfo"><span class="hs-identifier hs-type">ServerInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html"><span class="hs-identifier">ClickHouseDriver.IO.BufferedReader</span></a><span>
</span><a name="line-24"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryInt16"><span class="hs-identifier hs-var">readBinaryInt16</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryInt32"><span class="hs-identifier hs-var">readBinaryInt32</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryInt64"><span class="hs-identifier hs-var">readBinaryInt64</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryInt8"><span class="hs-identifier hs-var">readBinaryInt8</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryStr"><span class="hs-identifier hs-var">readBinaryStr</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryStrWithLength"><span class="hs-identifier hs-var">readBinaryStrWithLength</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt128"><span class="hs-identifier hs-var">readBinaryUInt128</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt16"><span class="hs-identifier hs-var">readBinaryUInt16</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt32"><span class="hs-identifier hs-var">readBinaryUInt32</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt64"><span class="hs-identifier hs-var">readBinaryUInt64</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt8"><span class="hs-identifier hs-var">readBinaryUInt8</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html"><span class="hs-identifier">ClickHouseDriver.IO.BufferedWriter</span></a><span>
</span><a name="line-38"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryFixedLengthStr"><span class="hs-identifier hs-var">writeBinaryFixedLengthStr</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt16"><span class="hs-identifier hs-var">writeBinaryInt16</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt32"><span class="hs-identifier hs-var">writeBinaryInt32</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt64"><span class="hs-identifier hs-var">writeBinaryInt64</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt8"><span class="hs-identifier hs-var">writeBinaryInt8</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryStr"><span class="hs-identifier hs-var">writeBinaryStr</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt128"><span class="hs-identifier hs-var">writeBinaryUInt128</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt16"><span class="hs-identifier hs-var">writeBinaryUInt16</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt32"><span class="hs-identifier hs-var">writeBinaryUInt32</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt64"><span class="hs-identifier hs-var">writeBinaryUInt64</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt8"><span class="hs-identifier hs-var">writeBinaryUInt8</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>    </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeVarUInt"><span class="hs-identifier hs-var">writeVarUInt</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.State.Lazy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadIO</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Binary</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Bits</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">shift</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.&amp;.</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.|.</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.ByteString</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BS</span><span>
</span><a name="line-57"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">drop</span><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>    </span><span class="hs-identifier hs-var">filter</span><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>    </span><span class="hs-identifier hs-var">intercalate</span><span class="hs-special">,</span><span>
</span><a name="line-60"></a><span>    </span><span class="hs-identifier hs-var">length</span><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>    </span><span class="hs-identifier hs-var">splitWith</span><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>    </span><span class="hs-identifier hs-var">take</span><span class="hs-special">,</span><span>
</span><a name="line-63"></a><span>    </span><span class="hs-identifier hs-var">unpack</span><span class="hs-special">,</span><span>
</span><a name="line-64"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.ByteString.Builder</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Builder</span><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.ByteString.Char8</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">readInt</span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Char8</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">C8</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.ByteString.Unsafe</span><span>
</span><a name="line-69"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">unsafePackCString</span><span class="hs-special">,</span><span>
</span><a name="line-70"></a><span>    </span><span class="hs-identifier hs-var">unsafeUseAsCStringLen</span><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.HashMap.Strict</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Hashable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Hashable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hash</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Int</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int32</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int64</span><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">List</span><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Time</span><span>
</span><a name="line-78"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">TimeZone</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-79"></a><span>    </span><span class="hs-identifier hs-var">addDays</span><span class="hs-special">,</span><span>
</span><a name="line-80"></a><span>    </span><span class="hs-identifier hs-var">diffDays</span><span class="hs-special">,</span><span>
</span><a name="line-81"></a><span>    </span><span class="hs-identifier hs-var">fromGregorian</span><span class="hs-special">,</span><span>
</span><a name="line-82"></a><span>    </span><span class="hs-identifier hs-var">getCurrentTimeZone</span><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>    </span><span class="hs-identifier hs-var">toGregorian</span><span class="hs-special">,</span><span>
</span><a name="line-84"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.UUID</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">UUID</span><span>
</span><a name="line-86"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">fromString</span><span class="hs-special">,</span><span>
</span><a name="line-87"></a><span>    </span><span class="hs-identifier hs-var">fromWords</span><span class="hs-special">,</span><span>
</span><a name="line-88"></a><span>    </span><span class="hs-identifier hs-var">toString</span><span class="hs-special">,</span><span>
</span><a name="line-89"></a><span>    </span><span class="hs-identifier hs-var">toWords</span><span class="hs-special">,</span><span>
</span><a name="line-90"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Vector</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Vector</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">V</span><span>
</span><a name="line-93"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">cons</span><span class="hs-special">,</span><span>
</span><a name="line-94"></a><span>    </span><span class="hs-identifier hs-var">drop</span><span class="hs-special">,</span><span>
</span><a name="line-95"></a><span>    </span><span class="hs-identifier hs-var">foldl'</span><span class="hs-special">,</span><span>
</span><a name="line-96"></a><span>    </span><span class="hs-identifier hs-var">fromList</span><span class="hs-special">,</span><span>
</span><a name="line-97"></a><span>    </span><span class="hs-identifier hs-var">generate</span><span class="hs-special">,</span><span>
</span><a name="line-98"></a><span>    </span><span class="hs-identifier hs-var">length</span><span class="hs-special">,</span><span>
</span><a name="line-99"></a><span>    </span><span class="hs-identifier hs-var">map</span><span class="hs-special">,</span><span>
</span><a name="line-100"></a><span>    </span><span class="hs-identifier hs-var">mapM</span><span class="hs-special">,</span><span>
</span><a name="line-101"></a><span>    </span><span class="hs-identifier hs-var">mapM_</span><span class="hs-special">,</span><span>
</span><a name="line-102"></a><span>    </span><span class="hs-identifier hs-var">replicateM</span><span class="hs-special">,</span><span>
</span><a name="line-103"></a><span>    </span><span class="hs-identifier hs-var">scanl'</span><span class="hs-special">,</span><span>
</span><a name="line-104"></a><span>    </span><span class="hs-identifier hs-var">sum</span><span class="hs-special">,</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-identifier hs-var">take</span><span class="hs-special">,</span><span>
</span><a name="line-106"></a><span>    </span><span class="hs-identifier hs-var">toList</span><span class="hs-special">,</span><span>
</span><a name="line-107"></a><span>    </span><span class="hs-identifier hs-var">zipWith</span><span class="hs-special">,</span><span>
</span><a name="line-108"></a><span>    </span><span class="hs-identifier hs-var">zipWithM_</span><span class="hs-special">,</span><span>
</span><a name="line-109"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign.C</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CString</span><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Network.IP.Addr</span><span>
</span><a name="line-112"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">IP4</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-113"></a><span>    </span><span class="hs-identifier hs-type">IP6</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-114"></a><span>    </span><span class="hs-identifier hs-var">ip4FromOctets</span><span class="hs-special">,</span><span>
</span><a name="line-115"></a><span>    </span><span class="hs-identifier hs-var">ip4ToOctets</span><span class="hs-special">,</span><span>
</span><a name="line-116"></a><span>    </span><span class="hs-identifier hs-var">ip6FromWords</span><span class="hs-special">,</span><span>
</span><a name="line-117"></a><span>    </span><span class="hs-identifier hs-var">ip6ToWords</span><span class="hs-special">,</span><span>
</span><a name="line-118"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-119"></a><span class="hs-cpp">#define EQUAL 61
#define COMMA 44
#define SPACE 32
#define QUOTE 39
</span><span class="hs-comment">--Debug</span><span>
</span><a name="line-124"></a><span class="hs-comment">--import Debug.Trace</span><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span class="hs-comment">-- Notice: Codes in this file might be difficult to read.</span><span>
</span><a name="line-127"></a><span class="hs-comment">---------------------------------------------------------------------------------------</span><span>
</span><a name="line-128"></a><span class="hs-comment">---Readers</span><span>
</span><a name="line-129"></a><span class="hs-identifier">readColumn</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-130"></a><span>  </span><span class="hs-comment">-- | Server information is needed in case of some parameters are missing</span><span>
</span><a name="line-131"></a><span>  </span><a href="ClickHouseDriver.Core.Types.html#ServerInfo"><span class="hs-identifier hs-type">ServerInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-132"></a><span>  </span><span class="hs-comment">-- | number of rows</span><span>
</span><a name="line-133"></a><span>  </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-134"></a><span>  </span><span class="hs-comment">-- | data type</span><span>
</span><a name="line-135"></a><span>  </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-136"></a><span>  </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-137"></a><a name="readColumn"><a href="ClickHouseDriver.Core.Column.html#readColumn"><span class="hs-identifier">readColumn</span></a></a><span> </span><a name="local-6989586621679132853"><a href="#local-6989586621679132853"><span class="hs-identifier">server_info</span></a></a><span> </span><a name="local-6989586621679132854"><a href="#local-6989586621679132854"><span class="hs-identifier">n_rows</span></a></a><span> </span><a name="local-6989586621679132855"><a href="#local-6989586621679132855"><span class="hs-identifier">spec</span></a></a><span>
</span><a name="line-138"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;String&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679132854"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKString"><span class="hs-identifier hs-var">CKString</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryStr"><span class="hs-identifier hs-var">readBinaryStr</span></a><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;Array&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679132853"><span class="hs-identifier hs-var">server_info</span></a><span> </span><a href="#local-6989586621679132854"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-140"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;FixedString&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readFixed"><span class="hs-identifier hs-var">readFixed</span></a><span> </span><a href="#local-6989586621679132854"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-141"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;DateTime&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readDateTime"><span class="hs-identifier hs-var">readDateTime</span></a><span> </span><a href="#local-6989586621679132853"><span class="hs-identifier hs-var">server_info</span></a><span> </span><a href="#local-6989586621679132854"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-142"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;Date&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readDate"><span class="hs-identifier hs-var">readDate</span></a><span> </span><a href="#local-6989586621679132854"><span class="hs-identifier hs-var">n_rows</span></a><span>
</span><a name="line-143"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;Tuple&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readTuple"><span class="hs-identifier hs-var">readTuple</span></a><span> </span><a href="#local-6989586621679132853"><span class="hs-identifier hs-var">server_info</span></a><span> </span><a href="#local-6989586621679132854"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-144"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;Nullable&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readNullable"><span class="hs-identifier hs-var">readNullable</span></a><span> </span><a href="#local-6989586621679132853"><span class="hs-identifier hs-var">server_info</span></a><span> </span><a href="#local-6989586621679132854"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-145"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;LowCardinality&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readLowCardinality"><span class="hs-identifier hs-var">readLowCardinality</span></a><span> </span><a href="#local-6989586621679132853"><span class="hs-identifier hs-var">server_info</span></a><span> </span><a href="#local-6989586621679132854"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-146"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;Decimal&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readDecimal"><span class="hs-identifier hs-var">readDecimal</span></a><span> </span><a href="#local-6989586621679132854"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-147"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;Enum&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readEnum"><span class="hs-identifier hs-var">readEnum</span></a><span> </span><a href="#local-6989586621679132854"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-148"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;Int&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readIntColumn"><span class="hs-identifier hs-var">readIntColumn</span></a><span> </span><a href="#local-6989586621679132854"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-149"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;UInt&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readIntColumn"><span class="hs-identifier hs-var">readIntColumn</span></a><span> </span><a href="#local-6989586621679132854"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-150"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;IPv4&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readIPv4"><span class="hs-identifier hs-var">readIPv4</span></a><span> </span><a href="#local-6989586621679132854"><span class="hs-identifier hs-var">n_rows</span></a><span>
</span><a name="line-151"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;IPv6&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readIPv6"><span class="hs-identifier hs-var">readIPv6</span></a><span> </span><a href="#local-6989586621679132854"><span class="hs-identifier hs-var">n_rows</span></a><span>
</span><a name="line-152"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;SimpleAggregateFunction&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readSimpleAggregateFunction"><span class="hs-identifier hs-var">readSimpleAggregateFunction</span></a><span> </span><a href="#local-6989586621679132853"><span class="hs-identifier hs-var">server_info</span></a><span> </span><a href="#local-6989586621679132854"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-153"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;UUID&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readUUID"><span class="hs-identifier hs-var">readUUID</span></a><span> </span><a href="#local-6989586621679132854"><span class="hs-identifier hs-var">n_rows</span></a><span>
</span><a name="line-154"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Unknown Type: &quot;</span><span> </span><span class="hs-operator hs-var">Prelude.++</span><span> </span><span class="hs-identifier hs-var">C8.unpack</span><span> </span><a href="#local-6989586621679132855"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-identifier">writeColumn</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-157"></a><span>  </span><span class="hs-comment">-- | context contains client information and server information</span><span>
</span><a name="line-158"></a><span>  </span><a href="ClickHouseDriver.Core.Types.html#Context"><span class="hs-identifier hs-type">Context</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-159"></a><span>  </span><span class="hs-comment">-- | column name</span><span>
</span><a name="line-160"></a><span>  </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-161"></a><span>  </span><span class="hs-comment">-- | column type (String, Int, etc)</span><span>
</span><a name="line-162"></a><span>  </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-163"></a><span>  </span><span class="hs-comment">-- | items to be serialized.</span><span>
</span><a name="line-164"></a><span>  </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-165"></a><span>  </span><span class="hs-comment">-- | result wrapped in a customized Writer Monad used for concatenating string builders.</span><span>
</span><a name="line-166"></a><span>  </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-167"></a><a name="writeColumn"><a href="ClickHouseDriver.Core.Column.html#writeColumn"><span class="hs-identifier">writeColumn</span></a></a><span> </span><a name="local-6989586621679132856"><a href="#local-6989586621679132856"><span class="hs-identifier">ctx</span></a></a><span> </span><a name="local-6989586621679132857"><a href="#local-6989586621679132857"><span class="hs-identifier">col_name</span></a></a><span> </span><a name="local-6989586621679132858"><a href="#local-6989586621679132858"><span class="hs-identifier">cktype</span></a></a><span> </span><a name="local-6989586621679132859"><a href="#local-6989586621679132859"><span class="hs-identifier">items</span></a></a><span>
</span><a name="line-168"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;String&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#writeStringColumn"><span class="hs-identifier hs-var">writeStringColumn</span></a><span> </span><a href="#local-6989586621679132857"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132859"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-169"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;FixedString(&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#writeFixedLengthString"><span class="hs-identifier hs-var">writeFixedLengthString</span></a><span> </span><a href="#local-6989586621679132857"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><a href="#local-6989586621679132859"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-170"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;Int&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#writeIntColumn"><span class="hs-identifier hs-var">writeIntColumn</span></a><span> </span><a href="#local-6989586621679132857"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><a href="#local-6989586621679132859"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-171"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;UInt&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#writeUIntColumn"><span class="hs-identifier hs-var">writeUIntColumn</span></a><span> </span><a href="#local-6989586621679132857"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><a href="#local-6989586621679132859"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-172"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;Nullable(&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#writeNullable"><span class="hs-identifier hs-var">writeNullable</span></a><span> </span><a href="#local-6989586621679132856"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="#local-6989586621679132857"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><a href="#local-6989586621679132859"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-173"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;Tuple&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#writeTuple"><span class="hs-identifier hs-var">writeTuple</span></a><span> </span><a href="#local-6989586621679132856"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="#local-6989586621679132857"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><a href="#local-6989586621679132859"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-174"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;Enum&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#writeEnum"><span class="hs-identifier hs-var">writeEnum</span></a><span> </span><a href="#local-6989586621679132857"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><a href="#local-6989586621679132859"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-175"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;Array&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a><span> </span><a href="#local-6989586621679132856"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="#local-6989586621679132857"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><a href="#local-6989586621679132859"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-176"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;UUID&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#writeUUID"><span class="hs-identifier hs-var">writeUUID</span></a><span> </span><a href="#local-6989586621679132857"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132859"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-177"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;IPv4&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#writeIPv4"><span class="hs-identifier hs-var">writeIPv4</span></a><span> </span><a href="#local-6989586621679132857"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132859"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-178"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;IPv6&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#writeIPv6"><span class="hs-identifier hs-var">writeIPv6</span></a><span> </span><a href="#local-6989586621679132857"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132859"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-179"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;Date&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#writeDate"><span class="hs-identifier hs-var">writeDate</span></a><span> </span><a href="#local-6989586621679132857"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132859"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-180"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;LowCardinality&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#writeLowCardinality"><span class="hs-identifier hs-var">writeLowCardinality</span></a><span> </span><a href="#local-6989586621679132856"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="#local-6989586621679132857"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><a href="#local-6989586621679132859"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-181"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;DateTime&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#writeDateTime"><span class="hs-identifier hs-var">writeDateTime</span></a><span> </span><a href="#local-6989586621679132857"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><a href="#local-6989586621679132859"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-182"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;Decimal&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#writeDecimal"><span class="hs-identifier hs-var">writeDecimal</span></a><span> </span><a href="#local-6989586621679132857"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132858"><span class="hs-identifier hs-var">cktype</span></a><span> </span><a href="#local-6989586621679132859"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-183"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Unknown Type in the column: &quot;</span><span> </span><span class="hs-operator hs-var">Prelude.++</span><span> </span><span class="hs-identifier hs-var">C8.unpack</span><span> </span><a href="#local-6989586621679132857"><span class="hs-identifier hs-var">col_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span class="hs-comment">---------------------------------------------------------------------------------------------</span><span>
</span><a name="line-185"></a><span class="hs-identifier">readFixed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-186"></a><a name="readFixed"><a href="ClickHouseDriver.Core.Column.html#readFixed"><span class="hs-identifier">readFixed</span></a></a><span> </span><a name="local-6989586621679132860"><a href="#local-6989586621679132860"><span class="hs-identifier">n_rows</span></a></a><span> </span><a name="local-6989586621679132861"><a href="#local-6989586621679132861"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-187"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679132862"><a href="#local-6989586621679132862"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679132861"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-188"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679132863"><a href="#local-6989586621679132863"><span class="hs-identifier">str_number</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679132862"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">13</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">12</span><span> </span><a href="#local-6989586621679132861"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679132864"><a href="#local-6989586621679132864"><span class="hs-identifier">number</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679132863"><span class="hs-identifier hs-var">str_number</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-190"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-comment">-- This can't happen</span><span>
</span><a name="line-191"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679132865"><a href="#local-6989586621679132865"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679132865"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-192"></a><span>  </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679132860"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#readFixedLengthString"><span class="hs-identifier hs-var">readFixedLengthString</span></a><span> </span><a href="#local-6989586621679132864"><span class="hs-identifier hs-var">number</span></a><span class="hs-special">)</span><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span class="hs-identifier">readFixedLengthString</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span>
</span><a name="line-195"></a><a name="readFixedLengthString"><a href="ClickHouseDriver.Core.Column.html#readFixedLengthString"><span class="hs-identifier">readFixedLengthString</span></a></a><span> </span><a name="local-6989586621679132866"><a href="#local-6989586621679132866"><span class="hs-identifier">str_len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Types.html#CKString"><span class="hs-identifier hs-var">CKString</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryStrWithLength"><span class="hs-identifier hs-var">readBinaryStrWithLength</span></a><span> </span><a href="#local-6989586621679132866"><span class="hs-identifier hs-var">str_len</span></a><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span class="hs-identifier">writeStringColumn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-198"></a><a name="writeStringColumn"><a href="ClickHouseDriver.Core.Column.html#writeStringColumn"><span class="hs-identifier">writeStringColumn</span></a></a><span> </span><a name="local-6989586621679132867"><a href="#local-6989586621679132867"><span class="hs-identifier">col_name</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-199"></a><span>  </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-200"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-201"></a><span>        </span><a href="ClickHouseDriver.Core.Types.html#CKString"><span class="hs-identifier hs-var">CKString</span></a><span> </span><a name="local-6989586621679132868"><a href="#local-6989586621679132868"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryStr"><span class="hs-identifier hs-var">writeBinaryStr</span></a><span> </span><a href="#local-6989586621679132868"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-202"></a><span>        </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeVarUInt"><span class="hs-identifier hs-var">writeVarUInt</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-203"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679132867"><span class="hs-identifier hs-var">col_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span class="hs-identifier">writeFixedLengthString</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-207"></a><a name="writeFixedLengthString"><a href="ClickHouseDriver.Core.Column.html#writeFixedLengthString"><span class="hs-identifier">writeFixedLengthString</span></a></a><span> </span><a name="local-6989586621679132869"><a href="#local-6989586621679132869"><span class="hs-identifier">col_name</span></a></a><span> </span><a name="local-6989586621679132870"><a href="#local-6989586621679132870"><span class="hs-identifier">spec</span></a></a><span> </span><a name="local-6989586621679132871"><a href="#local-6989586621679132871"><span class="hs-identifier">items</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-208"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679132872"><a href="#local-6989586621679132872"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679132870"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-209"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679132873"><a href="#local-6989586621679132873"><span class="hs-identifier">len</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679132872"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">13</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">12</span><span> </span><a href="#local-6989586621679132870"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>  </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-211"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-212"></a><span>        </span><a href="ClickHouseDriver.Core.Types.html#CKString"><span class="hs-identifier hs-var">CKString</span></a><span> </span><a name="local-6989586621679132874"><a href="#local-6989586621679132874"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryFixedLengthStr"><span class="hs-identifier hs-var">writeBinaryFixedLengthStr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679132873"><span class="hs-identifier hs-var">len</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679132874"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-213"></a><span>        </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679132873"><span class="hs-identifier hs-var">len</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeVarUInt"><span class="hs-identifier hs-var">writeVarUInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>        </span><a name="local-6989586621679132875"><a href="#local-6989586621679132875"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679132869"><span class="hs-identifier hs-var">col_name</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; got: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679132875"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-215"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>    </span><a href="#local-6989586621679132871"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span class="hs-comment">---------------------------------------------------------------------------------------------</span><span>
</span><a name="line-219"></a><span>
</span><a name="line-220"></a><span class="hs-comment">-- | read data in format of bytestring into format of haskell type.</span><span>
</span><a name="line-221"></a><span class="hs-identifier">readIntColumn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-222"></a><a name="readIntColumn"><a href="ClickHouseDriver.Core.Column.html#readIntColumn"><span class="hs-identifier">readIntColumn</span></a></a><span> </span><a name="local-6989586621679132876"><a href="#local-6989586621679132876"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-string">&quot;Int8&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679132876"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKInt8"><span class="hs-identifier hs-var">CKInt8</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryInt8"><span class="hs-identifier hs-var">readBinaryInt8</span></a><span class="hs-special">)</span><span>
</span><a name="line-223"></a><span class="hs-identifier">readIntColumn</span><span> </span><a name="local-6989586621679132877"><a href="#local-6989586621679132877"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-string">&quot;Int16&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679132877"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKInt16"><span class="hs-identifier hs-var">CKInt16</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryInt16"><span class="hs-identifier hs-var">readBinaryInt16</span></a><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span class="hs-identifier">readIntColumn</span><span> </span><a name="local-6989586621679132878"><a href="#local-6989586621679132878"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-string">&quot;Int32&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679132878"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKInt32"><span class="hs-identifier hs-var">CKInt32</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryInt32"><span class="hs-identifier hs-var">readBinaryInt32</span></a><span class="hs-special">)</span><span>
</span><a name="line-225"></a><span class="hs-identifier">readIntColumn</span><span> </span><a name="local-6989586621679132879"><a href="#local-6989586621679132879"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-string">&quot;Int64&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679132879"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKInt64"><span class="hs-identifier hs-var">CKInt64</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryInt64"><span class="hs-identifier hs-var">readBinaryInt64</span></a><span class="hs-special">)</span><span>
</span><a name="line-226"></a><span class="hs-identifier">readIntColumn</span><span> </span><a name="local-6989586621679132880"><a href="#local-6989586621679132880"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-string">&quot;UInt8&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679132880"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKUInt8"><span class="hs-identifier hs-var">CKUInt8</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt8"><span class="hs-identifier hs-var">readBinaryUInt8</span></a><span class="hs-special">)</span><span>
</span><a name="line-227"></a><span class="hs-identifier">readIntColumn</span><span> </span><a name="local-6989586621679132881"><a href="#local-6989586621679132881"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-string">&quot;UInt16&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679132881"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKUInt16"><span class="hs-identifier hs-var">CKUInt16</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt16"><span class="hs-identifier hs-var">readBinaryUInt16</span></a><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span class="hs-identifier">readIntColumn</span><span> </span><a name="local-6989586621679132882"><a href="#local-6989586621679132882"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-string">&quot;UInt32&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679132882"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKUInt32"><span class="hs-identifier hs-var">CKUInt32</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt32"><span class="hs-identifier hs-var">readBinaryUInt32</span></a><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span class="hs-identifier">readIntColumn</span><span> </span><a name="local-6989586621679132883"><a href="#local-6989586621679132883"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-string">&quot;UInt64&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679132883"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKUInt64"><span class="hs-identifier hs-var">CKUInt64</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt64"><span class="hs-identifier hs-var">readBinaryUInt64</span></a><span class="hs-special">)</span><span>
</span><a name="line-230"></a><span class="hs-identifier">readIntColumn</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679132884"><a href="#local-6989586621679132884"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;expect an integer but got: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679132884"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span class="hs-identifier">writeIntColumn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-233"></a><a name="writeIntColumn"><a href="ClickHouseDriver.Core.Column.html#writeIntColumn"><span class="hs-identifier">writeIntColumn</span></a></a><span> </span><a name="local-6989586621679132885"><a href="#local-6989586621679132885"><span class="hs-identifier">col_name</span></a></a><span> </span><a name="local-6989586621679132886"><a href="#local-6989586621679132886"><span class="hs-identifier">spec</span></a></a><span> </span><a name="local-6989586621679132887"><a href="#local-6989586621679132887"><span class="hs-identifier">items</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-234"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679132895"><a href="#local-6989586621679132895"><span class="hs-identifier">indicator</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">3</span><span> </span><a href="#local-6989586621679132886"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-comment">-- indicator indicates which integer type, is it Int8 or Int64 etc.</span><span>
</span><a name="line-235"></a><span>  </span><a href="#local-6989586621679132888"><span class="hs-identifier hs-var">writeIntColumn'</span></a><span> </span><a href="#local-6989586621679132895"><span class="hs-identifier hs-var">indicator</span></a><span> </span><a href="#local-6989586621679132885"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132887"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-236"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-237"></a><span>    </span><span class="hs-identifier">writeIntColumn'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-238"></a><span>    </span><a name="local-6989586621679132888"><a href="#local-6989586621679132888"><span class="hs-identifier">writeIntColumn'</span></a></a><span> </span><a name="local-6989586621679132889"><a href="#local-6989586621679132889"><span class="hs-identifier">indicator</span></a></a><span> </span><a name="local-6989586621679132890"><a href="#local-6989586621679132890"><span class="hs-identifier">col_name</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-239"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679132889"><span class="hs-identifier hs-var">indicator</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-240"></a><span>        </span><span class="hs-number">8</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-241"></a><span>          </span><span class="hs-identifier hs-var">V.mapM_</span><span> </span><span class="hs-comment">-- mapM_ acts like for-loop in this context, since it repeats monadic actions.</span><span>
</span><a name="line-242"></a><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-243"></a><span>                </span><a href="ClickHouseDriver.Core.Types.html#CKInt8"><span class="hs-identifier hs-var">CKInt8</span></a><span> </span><a name="local-6989586621679132891"><a href="#local-6989586621679132891"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt8"><span class="hs-identifier hs-var">writeBinaryInt8</span></a><span> </span><a href="#local-6989586621679132891"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-244"></a><span>                </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt8"><span class="hs-identifier hs-var">writeBinaryInt8</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-245"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679132890"><span class="hs-identifier hs-var">col_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-246"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>        </span><span class="hs-number">16</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-248"></a><span>          </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-249"></a><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-250"></a><span>                </span><a href="ClickHouseDriver.Core.Types.html#CKInt16"><span class="hs-identifier hs-var">CKInt16</span></a><span> </span><a name="local-6989586621679132892"><a href="#local-6989586621679132892"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt16"><span class="hs-identifier hs-var">writeBinaryInt16</span></a><span> </span><a href="#local-6989586621679132892"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-251"></a><span>                </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt16"><span class="hs-identifier hs-var">writeBinaryInt16</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-252"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679132890"><span class="hs-identifier hs-var">col_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-254"></a><span>        </span><span class="hs-number">32</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-255"></a><span>          </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-256"></a><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-257"></a><span>                </span><a href="ClickHouseDriver.Core.Types.html#CKInt32"><span class="hs-identifier hs-var">CKInt32</span></a><span> </span><a name="local-6989586621679132893"><a href="#local-6989586621679132893"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt32"><span class="hs-identifier hs-var">writeBinaryInt32</span></a><span> </span><a href="#local-6989586621679132893"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-258"></a><span>                </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt32"><span class="hs-identifier hs-var">writeBinaryInt32</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-259"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679132890"><span class="hs-identifier hs-var">col_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-261"></a><span>        </span><span class="hs-number">64</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-262"></a><span>          </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-263"></a><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-264"></a><span>                </span><a href="ClickHouseDriver.Core.Types.html#CKInt64"><span class="hs-identifier hs-var">CKInt64</span></a><span> </span><a name="local-6989586621679132894"><a href="#local-6989586621679132894"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt64"><span class="hs-identifier hs-var">writeBinaryInt64</span></a><span> </span><a href="#local-6989586621679132894"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-265"></a><span>                </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt64"><span class="hs-identifier hs-var">writeBinaryInt64</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-266"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679132890"><span class="hs-identifier hs-var">col_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-267"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-identifier">writeUIntColumn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-270"></a><a name="writeUIntColumn"><a href="ClickHouseDriver.Core.Column.html#writeUIntColumn"><span class="hs-identifier">writeUIntColumn</span></a></a><span> </span><a name="local-6989586621679132896"><a href="#local-6989586621679132896"><span class="hs-identifier">col_name</span></a></a><span> </span><a name="local-6989586621679132897"><a href="#local-6989586621679132897"><span class="hs-identifier">spec</span></a></a><span> </span><a name="local-6989586621679132898"><a href="#local-6989586621679132898"><span class="hs-identifier">items</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-271"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679132906"><a href="#local-6989586621679132906"><span class="hs-identifier">indicator</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">4</span><span> </span><a href="#local-6989586621679132897"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-272"></a><span>  </span><a href="#local-6989586621679132899"><span class="hs-identifier hs-var">writeUIntColumn'</span></a><span> </span><a href="#local-6989586621679132906"><span class="hs-identifier hs-var">indicator</span></a><span> </span><a href="#local-6989586621679132896"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679132898"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-273"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-274"></a><span>    </span><span class="hs-identifier">writeUIntColumn'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-275"></a><span>    </span><a name="local-6989586621679132899"><a href="#local-6989586621679132899"><span class="hs-identifier">writeUIntColumn'</span></a></a><span> </span><a name="local-6989586621679132900"><a href="#local-6989586621679132900"><span class="hs-identifier">indicator</span></a></a><span> </span><a name="local-6989586621679132901"><a href="#local-6989586621679132901"><span class="hs-identifier">col_name</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-276"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679132900"><span class="hs-identifier hs-var">indicator</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-277"></a><span>        </span><span class="hs-number">8</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-278"></a><span>          </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-279"></a><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-280"></a><span>                </span><a href="ClickHouseDriver.Core.Types.html#CKUInt8"><span class="hs-identifier hs-var">CKUInt8</span></a><span> </span><a name="local-6989586621679132902"><a href="#local-6989586621679132902"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt8"><span class="hs-identifier hs-var">writeBinaryUInt8</span></a><span> </span><a href="#local-6989586621679132902"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-281"></a><span>                </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt8"><span class="hs-identifier hs-var">writeBinaryUInt8</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-282"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679132901"><span class="hs-identifier hs-var">col_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-283"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-284"></a><span>        </span><span class="hs-number">16</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-285"></a><span>          </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-286"></a><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-287"></a><span>                </span><a href="ClickHouseDriver.Core.Types.html#CKUInt16"><span class="hs-identifier hs-var">CKUInt16</span></a><span> </span><a name="local-6989586621679132903"><a href="#local-6989586621679132903"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt16"><span class="hs-identifier hs-var">writeBinaryInt16</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679132903"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-288"></a><span>                </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt16"><span class="hs-identifier hs-var">writeBinaryInt16</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-289"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679132901"><span class="hs-identifier hs-var">col_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-290"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-291"></a><span>        </span><span class="hs-number">32</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-292"></a><span>          </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-293"></a><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-294"></a><span>                </span><a href="ClickHouseDriver.Core.Types.html#CKUInt32"><span class="hs-identifier hs-var">CKUInt32</span></a><span> </span><a name="local-6989586621679132904"><a href="#local-6989586621679132904"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt32"><span class="hs-identifier hs-var">writeBinaryInt32</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679132904"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-295"></a><span>                </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt32"><span class="hs-identifier hs-var">writeBinaryInt32</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-296"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679132901"><span class="hs-identifier hs-var">col_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-297"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-298"></a><span>        </span><span class="hs-number">64</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-299"></a><span>          </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-300"></a><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-301"></a><span>                </span><a href="ClickHouseDriver.Core.Types.html#CKUInt64"><span class="hs-identifier hs-var">CKUInt64</span></a><span> </span><a name="local-6989586621679132905"><a href="#local-6989586621679132905"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt64"><span class="hs-identifier hs-var">writeBinaryInt64</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679132905"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-302"></a><span>                </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt64"><span class="hs-identifier hs-var">writeBinaryInt64</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-303"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679132901"><span class="hs-identifier hs-var">col_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-304"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-305"></a><span>
</span><a name="line-306"></a><span class="hs-comment">---------------------------------------------------------------------------------------------</span><span>
</span><a name="line-307"></a><span>
</span><a name="line-308"></a><span class="hs-comment">{-
  There are two types of Datetime
  DateTime(TZ) or DateTime64(precision,TZ)
  server information is required if TZ parameter is missing.
-}</span><span>
</span><a name="line-313"></a><span class="hs-identifier">readDateTime</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ServerInfo"><span class="hs-identifier hs-type">ServerInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-314"></a><a name="readDateTime"><a href="ClickHouseDriver.Core.Column.html#readDateTime"><span class="hs-identifier">readDateTime</span></a></a><span> </span><a name="local-6989586621679132907"><a href="#local-6989586621679132907"><span class="hs-identifier">server_info</span></a></a><span> </span><a name="local-6989586621679132908"><a href="#local-6989586621679132908"><span class="hs-identifier">n_rows</span></a></a><span> </span><a name="local-6989586621679132909"><a href="#local-6989586621679132909"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-315"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679132910"><a href="#local-6989586621679132910"><span class="hs-identifier">scale</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679132911"><a href="#local-6989586621679132911"><span class="hs-identifier">spc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readTimeSpec"><span class="hs-identifier hs-var">readTimeSpec</span></a><span> </span><a href="#local-6989586621679132909"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-316"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679132911"><span class="hs-identifier hs-var">spc</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-317"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readDateTimeWithSpec"><span class="hs-identifier hs-var">readDateTimeWithSpec</span></a><span> </span><a href="#local-6989586621679132907"><span class="hs-identifier hs-var">server_info</span></a><span> </span><a href="#local-6989586621679132908"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="#local-6989586621679132910"><span class="hs-identifier hs-var">scale</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-318"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679132912"><a href="#local-6989586621679132912"><span class="hs-identifier">tz_name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readDateTimeWithSpec"><span class="hs-identifier hs-var">readDateTimeWithSpec</span></a><span> </span><a href="#local-6989586621679132907"><span class="hs-identifier hs-var">server_info</span></a><span> </span><a href="#local-6989586621679132908"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="#local-6989586621679132910"><span class="hs-identifier hs-var">scale</span></a><span> </span><a href="#local-6989586621679132912"><span class="hs-identifier hs-var">tz_name</span></a><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span class="hs-identifier">readTimeSpec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-321"></a><a name="readTimeSpec"><a href="ClickHouseDriver.Core.Column.html#readTimeSpec"><span class="hs-identifier">readTimeSpec</span></a></a><span> </span><a name="local-6989586621679132913"><a href="#local-6989586621679132913"><span class="hs-identifier">spec'</span></a></a><span>
</span><a name="line-322"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;DateTime64&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132913"><span class="hs-identifier hs-var">spec'</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-323"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679132914"><a href="#local-6989586621679132914"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679132913"><span class="hs-identifier hs-var">spec'</span></a><span>
</span><a name="line-324"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679132915"><a href="#local-6989586621679132915"><span class="hs-identifier">inner_specs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679132914"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">12</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679132913"><span class="hs-identifier hs-var">spec'</span></a><span class="hs-special">)</span><span>
</span><a name="line-325"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679132916"><a href="#local-6989586621679132916"><span class="hs-identifier">split</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#getSpecs"><span class="hs-identifier hs-var">getSpecs</span></a><span> </span><a href="#local-6989586621679132915"><span class="hs-identifier hs-var">inner_specs</span></a><span>
</span><a name="line-326"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679132916"><span class="hs-identifier hs-var">split</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-327"></a><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-328"></a><span>      </span><span class="hs-special">[</span><a name="local-6989586621679132917"><a href="#local-6989586621679132917"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679132917"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-329"></a><span>      </span><span class="hs-special">[</span><a name="local-6989586621679132933"><a href="#local-6989586621679132933"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679132934"><a href="#local-6989586621679132934"><span class="hs-identifier">y</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679132933"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679132934"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-330"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-331"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679132935"><a href="#local-6989586621679132935"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679132913"><span class="hs-identifier hs-var">spec'</span></a><span>
</span><a name="line-332"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679132936"><a href="#local-6989586621679132936"><span class="hs-identifier">inner_specs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679132935"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">12</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">10</span><span> </span><a href="#local-6989586621679132913"><span class="hs-identifier hs-var">spec'</span></a><span class="hs-special">)</span><span>
</span><a name="line-333"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679132936"><span class="hs-identifier hs-var">inner_specs</span></a><span class="hs-special">)</span><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span class="hs-identifier">readDateTimeWithSpec</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ServerInfo"><span class="hs-identifier hs-type">ServerInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-336"></a><a name="readDateTimeWithSpec"><a href="ClickHouseDriver.Core.Column.html#readDateTimeWithSpec"><span class="hs-identifier">readDateTimeWithSpec</span></a></a><span> </span><a href="ClickHouseDriver.Core.Types.html#ServerInfo"><span class="hs-identifier hs-var">ServerInfo</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">timezone</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679132937"><a href="#local-6989586621679132937"><span class="hs-identifier">maybe_zone</span></a></a><span class="hs-special">}</span><span> </span><a name="local-6989586621679132938"><a href="#local-6989586621679132938"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a name="local-6989586621679132939"><a href="#local-6989586621679132939"><span class="hs-identifier">tz_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-337"></a><span>  </span><a name="local-6989586621679132940"><a href="#local-6989586621679132940"><span class="hs-identifier">data32</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readIntColumn"><span class="hs-identifier hs-var">readIntColumn</span></a><span> </span><a href="#local-6989586621679132938"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-string">&quot;Int32&quot;</span><span>
</span><a name="line-338"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679132941"><a href="#local-6989586621679132941"><span class="hs-identifier">tz_to_send</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-339"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679132939"><span class="hs-identifier hs-var">tz_name</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-340"></a><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-string">&quot;TZ=&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679132939"><span class="hs-identifier hs-var">tz_name</span></a><span>
</span><a name="line-341"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><a href="#local-6989586621679132937"><span class="hs-identifier hs-var">maybe_zone</span></a><span>
</span><a name="line-342"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679132942"><a href="#local-6989586621679132942"><span class="hs-identifier">toDateTimeStringM</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-343"></a><span>        </span><span class="hs-identifier hs-var">V.mapM</span><span>
</span><a name="line-344"></a><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKInt32"><span class="hs-identifier hs-var">CKInt32</span></a><span> </span><a name="local-6989586621679132943"><a href="#local-6989586621679132943"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-345"></a><span>              </span><a name="local-6989586621679132944"><a href="#local-6989586621679132944"><span class="hs-identifier">c_str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-346"></a><span>                </span><span class="hs-identifier hs-var">unsafeUseAsCStringLen</span><span>
</span><a name="line-347"></a><span>                  </span><a href="#local-6989586621679132941"><span class="hs-identifier hs-var">tz_to_send</span></a><span>
</span><a name="line-348"></a><span>                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#c_convert_time"><span class="hs-identifier hs-var">c_convert_time</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679132943"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-349"></a><span>              </span><span class="hs-identifier hs-var">unsafePackCString</span><span> </span><a href="#local-6989586621679132944"><span class="hs-identifier hs-var">c_str</span></a><span>
</span><a name="line-350"></a><span>          </span><span class="hs-special">)</span><span>
</span><a name="line-351"></a><span>          </span><a href="#local-6989586621679132940"><span class="hs-identifier hs-var">data32</span></a><span>
</span><a name="line-352"></a><span>  </span><a name="local-6989586621679132945"><a href="#local-6989586621679132945"><span class="hs-identifier">toDateTimeString</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679132942"><span class="hs-identifier hs-var">toDateTimeStringM</span></a><span>
</span><a name="line-353"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.map</span><span> </span><a href="ClickHouseDriver.Core.Types.html#CKString"><span class="hs-identifier hs-var">CKString</span></a><span> </span><a href="#local-6989586621679132945"><span class="hs-identifier hs-var">toDateTimeString</span></a><span>
</span><a name="line-354"></a><span>
</span><a name="line-355"></a><span class="hs-identifier">readDateTimeWithSpec</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ServerInfo"><span class="hs-identifier hs-var">ServerInfo</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">timezone</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679132946"><a href="#local-6989586621679132946"><span class="hs-identifier">maybe_zone</span></a></a><span class="hs-special">}</span><span> </span><a name="local-6989586621679132947"><a href="#local-6989586621679132947"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679132948"><a href="#local-6989586621679132948"><span class="hs-identifier">scl</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679132949"><a href="#local-6989586621679132949"><span class="hs-identifier">tz_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-356"></a><span>  </span><a name="local-6989586621679132950"><a href="#local-6989586621679132950"><span class="hs-identifier">data64</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readIntColumn"><span class="hs-identifier hs-var">readIntColumn</span></a><span> </span><a href="#local-6989586621679132947"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-string">&quot;Int64&quot;</span><span>
</span><a name="line-357"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679132951"><a href="#local-6989586621679132951"><span class="hs-identifier">scale</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">10</span><span> </span><span class="hs-operator hs-var">^</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679132948"><span class="hs-identifier hs-var">scl</span></a><span>
</span><a name="line-358"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679132952"><a href="#local-6989586621679132952"><span class="hs-identifier">tz_to_send</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-359"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679132949"><span class="hs-identifier hs-var">tz_name</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-360"></a><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-string">&quot;TZ=&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679132949"><span class="hs-identifier hs-var">tz_name</span></a><span>
</span><a name="line-361"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><a href="#local-6989586621679132946"><span class="hs-identifier hs-var">maybe_zone</span></a><span>
</span><a name="line-362"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679132953"><a href="#local-6989586621679132953"><span class="hs-identifier">toDateTimeStringM</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-363"></a><span>        </span><span class="hs-identifier hs-var">V.mapM</span><span>
</span><a name="line-364"></a><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKInt64"><span class="hs-identifier hs-var">CKInt64</span></a><span> </span><a name="local-6989586621679132954"><a href="#local-6989586621679132954"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-365"></a><span>              </span><a name="local-6989586621679132955"><a href="#local-6989586621679132955"><span class="hs-identifier">c_str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-366"></a><span>                </span><span class="hs-identifier hs-var">unsafeUseAsCStringLen</span><span>
</span><a name="line-367"></a><span>                  </span><a href="#local-6989586621679132952"><span class="hs-identifier hs-var">tz_to_send</span></a><span>
</span><a name="line-368"></a><span>                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#c_convert_time64"><span class="hs-identifier hs-var">c_convert_time64</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679132954"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">/</span><span> </span><a href="#local-6989586621679132951"><span class="hs-identifier hs-var">scale</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-369"></a><span>              </span><span class="hs-identifier hs-var">unsafePackCString</span><span> </span><a href="#local-6989586621679132955"><span class="hs-identifier hs-var">c_str</span></a><span>
</span><a name="line-370"></a><span>          </span><span class="hs-special">)</span><span>
</span><a name="line-371"></a><span>          </span><a href="#local-6989586621679132950"><span class="hs-identifier hs-var">data64</span></a><span>
</span><a name="line-372"></a><span>  </span><a name="local-6989586621679132956"><a href="#local-6989586621679132956"><span class="hs-identifier">toDateTimeString</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679132953"><span class="hs-identifier hs-var">toDateTimeStringM</span></a><span>
</span><a name="line-373"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.map</span><span> </span><a href="ClickHouseDriver.Core.Types.html#CKString"><span class="hs-identifier hs-var">CKString</span></a><span> </span><a href="#local-6989586621679132956"><span class="hs-identifier hs-var">toDateTimeString</span></a><span>
</span><a name="line-374"></a><span>
</span><a name="line-375"></a><span class="hs-identifier">writeDateTime</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-376"></a><a name="writeDateTime"><a href="ClickHouseDriver.Core.Column.html#writeDateTime"><span class="hs-identifier">writeDateTime</span></a></a><span> </span><a name="local-6989586621679132957"><a href="#local-6989586621679132957"><span class="hs-identifier">col_name</span></a></a><span> </span><a name="local-6989586621679132958"><a href="#local-6989586621679132958"><span class="hs-identifier">spec</span></a></a><span> </span><a name="local-6989586621679132959"><a href="#local-6989586621679132959"><span class="hs-identifier">items</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-377"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679132970"><a href="#local-6989586621679132970"><span class="hs-identifier">scale'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679132971"><a href="#local-6989586621679132971"><span class="hs-identifier">spc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readTimeSpec"><span class="hs-identifier hs-var">readTimeSpec</span></a><span> </span><a href="#local-6989586621679132958"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-378"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679132970"><span class="hs-identifier hs-var">scale'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-379"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-380"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679132971"><span class="hs-identifier hs-var">spc</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-381"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-382"></a><span>          </span><span class="hs-identifier hs-var">TimeZone</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">timeZoneName</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679133146"><a href="#local-6989586621679133146"><span class="hs-identifier">tz'</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">getCurrentTimeZone</span><span>
</span><a name="line-383"></a><span>          </span><a href="#local-6989586621679132960"><span class="hs-identifier hs-var">writeDateTimeWithSpec</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><a href="#local-6989586621679133146"><span class="hs-identifier hs-var">tz'</span></a><span>
</span><a name="line-384"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679133147"><a href="#local-6989586621679133147"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679132960"><span class="hs-identifier hs-var">writeDateTimeWithSpec</span></a><span> </span><a href="#local-6989586621679133147"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-385"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-386"></a><span>      </span><span class="hs-comment">--TODO: Can someone implement this? I am so pissed off!</span><span>
</span><a name="line-387"></a><span>      </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-388"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-389"></a><span>    </span><span class="hs-identifier">writeDateTimeWithSpec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-390"></a><span>    </span><a name="local-6989586621679132960"><a href="#local-6989586621679132960"><span class="hs-identifier">writeDateTimeWithSpec</span></a></a><span> </span><a name="local-6989586621679132961"><a href="#local-6989586621679132961"><span class="hs-identifier">tz_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-391"></a><span>      </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-392"></a><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-393"></a><span>            </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKInt32"><span class="hs-identifier hs-var">CKInt32</span></a><span> </span><a name="local-6989586621679132962"><a href="#local-6989586621679132962"><span class="hs-identifier">i32</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-394"></a><span>              </span><a name="local-6989586621679132963"><a href="#local-6989586621679132963"><span class="hs-identifier">converted</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Column.html#convert_time_from_int32"><span class="hs-identifier hs-var">convert_time_from_int32</span></a><span> </span><a href="#local-6989586621679132962"><span class="hs-identifier hs-var">i32</span></a><span>
</span><a name="line-395"></a><span>              </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt32"><span class="hs-identifier hs-var">writeBinaryInt32</span></a><span> </span><a href="#local-6989586621679132963"><span class="hs-identifier hs-var">converted</span></a><span>
</span><a name="line-396"></a><span>            </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKString"><span class="hs-identifier hs-var">CKString</span></a><span> </span><a name="local-6989586621679132964"><a href="#local-6989586621679132964"><span class="hs-identifier">time_str</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-397"></a><span>              </span><a name="local-6989586621679132969"><a href="#local-6989586621679132969"><span class="hs-identifier">converted</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-398"></a><span>                </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-399"></a><span>                  </span><span class="hs-identifier hs-var">unsafeUseAsCStringLen</span><span>
</span><a name="line-400"></a><span>                    </span><a href="#local-6989586621679132961"><span class="hs-identifier hs-var">tz_name</span></a><span>
</span><a name="line-401"></a><span>                    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679132965"><a href="#local-6989586621679132965"><span class="hs-identifier">tz</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679132966"><a href="#local-6989586621679132966"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-402"></a><span>                        </span><span class="hs-identifier hs-var">unsafeUseAsCStringLen</span><span>
</span><a name="line-403"></a><span>                          </span><a href="#local-6989586621679132964"><span class="hs-identifier hs-var">time_str</span></a><span>
</span><a name="line-404"></a><span>                          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679132967"><a href="#local-6989586621679132967"><span class="hs-identifier">time_str</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679132968"><a href="#local-6989586621679132968"><span class="hs-identifier">l2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.Core.Column.html#c_write_time"><span class="hs-identifier hs-var">c_write_time</span></a><span> </span><a href="#local-6989586621679132967"><span class="hs-identifier hs-var">time_str</span></a><span> </span><a href="#local-6989586621679132965"><span class="hs-identifier hs-var">tz</span></a><span> </span><a href="#local-6989586621679132966"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679132968"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span>
</span><a name="line-405"></a><span>                    </span><span class="hs-special">)</span><span>
</span><a name="line-406"></a><span>              </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt32"><span class="hs-identifier hs-var">writeBinaryInt32</span></a><span> </span><a href="#local-6989586621679132969"><span class="hs-identifier hs-var">converted</span></a><span>
</span><a name="line-407"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679132957"><span class="hs-identifier hs-var">col_name</span></a><span class="hs-special">)</span><span>
</span><a name="line-408"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-409"></a><span>        </span><a href="#local-6989586621679132959"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-410"></a><span>
</span><a name="line-411"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;datetime.h convert_time&quot;</span><span> </span><span class="hs-identifier">c_convert_time</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">CString</span><span>
</span><a name="line-412"></a><span>
</span><a name="line-413"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;datetime.h convert_time&quot;</span><span> </span><span class="hs-identifier">c_convert_time64</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Float</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">CString</span><span>
</span><a name="line-414"></a><span>
</span><a name="line-415"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;datetime.h parse_time&quot;</span><span> </span><span class="hs-identifier">c_write_time</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Int32</span><span>
</span><a name="line-416"></a><span>
</span><a name="line-417"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;datetime.h convert_time_from_int32&quot;</span><span> </span><span class="hs-identifier">convert_time_from_int32</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Int32</span><span>
</span><a name="line-418"></a><span>
</span><a name="line-419"></a><span class="hs-comment">------------------------------------------------------------------------------------------------</span><span>
</span><a name="line-420"></a><span class="hs-identifier">readLowCardinality</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ServerInfo"><span class="hs-identifier hs-type">ServerInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-421"></a><a name="readLowCardinality"><a href="ClickHouseDriver.Core.Column.html#readLowCardinality"><span class="hs-identifier">readLowCardinality</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">V.fromList</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-422"></a><span class="hs-identifier">readLowCardinality</span><span> </span><a name="local-6989586621679133148"><a href="#local-6989586621679133148"><span class="hs-identifier">server_info</span></a></a><span> </span><a name="local-6989586621679133149"><a href="#local-6989586621679133149"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679133150"><a href="#local-6989586621679133150"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-423"></a><span>  </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt64"><span class="hs-identifier hs-var">readBinaryUInt64</span></a><span> </span><span class="hs-comment">--state prefix</span><span>
</span><a name="line-424"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133154"><a href="#local-6989586621679133154"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679133150"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-425"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133155"><a href="#local-6989586621679133155"><span class="hs-identifier">inner</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679133154"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">15</span><span> </span><a href="#local-6989586621679133150"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-426"></a><span>  </span><a name="local-6989586621679133156"><a href="#local-6989586621679133156"><span class="hs-identifier">serialization_type</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt64"><span class="hs-identifier hs-var">readBinaryUInt64</span></a><span>
</span><a name="line-427"></a><span>  </span><span class="hs-comment">-- Lowest bytes contains info about key type.</span><span>
</span><a name="line-428"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133157"><a href="#local-6989586621679133157"><span class="hs-identifier">key_type</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679133156"><span class="hs-identifier hs-var">serialization_type</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><span class="hs-number">0xf</span><span>
</span><a name="line-429"></a><span>  </span><a name="local-6989586621679133158"><a href="#local-6989586621679133158"><span class="hs-identifier">index_size</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt64"><span class="hs-identifier hs-var">readBinaryUInt64</span></a><span>
</span><a name="line-430"></a><span>  </span><span class="hs-comment">-- Strip the 'Nullable' tag to avoid null map reading.</span><span>
</span><a name="line-431"></a><span>  </span><a name="local-6989586621679133159"><a href="#local-6989586621679133159"><span class="hs-identifier">index</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readColumn"><span class="hs-identifier hs-var">readColumn</span></a><span> </span><a href="#local-6989586621679133148"><span class="hs-identifier hs-var">server_info</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679133158"><span class="hs-identifier hs-var">index_size</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679133151"><span class="hs-identifier hs-var">stripNullable</span></a><span> </span><a href="#local-6989586621679133155"><span class="hs-identifier hs-var">inner</span></a><span class="hs-special">)</span><span>
</span><a name="line-432"></a><span>  </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt64"><span class="hs-identifier hs-var">readBinaryUInt64</span></a><span> </span><span class="hs-comment">-- #keys</span><span>
</span><a name="line-433"></a><span>  </span><a name="local-6989586621679133160"><a href="#local-6989586621679133160"><span class="hs-identifier">keys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679133157"><span class="hs-identifier hs-var">key_type</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-434"></a><span>    </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">V.map</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679133149"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt8"><span class="hs-identifier hs-var">readBinaryUInt8</span></a><span>
</span><a name="line-435"></a><span>    </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">V.map</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679133149"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt16"><span class="hs-identifier hs-var">readBinaryUInt16</span></a><span>
</span><a name="line-436"></a><span>    </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">V.map</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679133149"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt32"><span class="hs-identifier hs-var">readBinaryUInt32</span></a><span>
</span><a name="line-437"></a><span>    </span><span class="hs-number">3</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">V.map</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679133149"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt64"><span class="hs-identifier hs-var">readBinaryUInt64</span></a><span>
</span><a name="line-438"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-string">&quot;Nullable&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679133155"><span class="hs-identifier hs-var">inner</span></a><span>
</span><a name="line-439"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-440"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133161"><a href="#local-6989586621679133161"><span class="hs-identifier">nullable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679133162"><a href="#local-6989586621679133162"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679133162"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679133159"><span class="hs-identifier hs-var">index</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679133162"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679133160"><span class="hs-identifier hs-var">keys</span></a><span>
</span><a name="line-441"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679133161"><span class="hs-identifier hs-var">nullable</span></a><span>
</span><a name="line-442"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679133159"><span class="hs-identifier hs-var">index</span></a><span> </span><span class="hs-glyph">!</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679133160"><span class="hs-identifier hs-var">keys</span></a><span>
</span><a name="line-443"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-444"></a><span>    </span><span class="hs-identifier">stripNullable</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-445"></a><span>    </span><a name="local-6989586621679133151"><a href="#local-6989586621679133151"><span class="hs-identifier">stripNullable</span></a></a><span> </span><a name="local-6989586621679133153"><a href="#local-6989586621679133153"><span class="hs-identifier">spec</span></a></a><span>
</span><a name="line-446"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-string">&quot;Nullable&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679133153"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679133152"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">10</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">9</span><span> </span><a href="#local-6989586621679133153"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-447"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679133153"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-448"></a><span>    </span><a name="local-6989586621679133152"><a href="#local-6989586621679133152"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679133150"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-449"></a><span>
</span><a name="line-450"></a><span class="hs-identifier">writeLowCardinality</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ClickHouseDriver.Core.Types.html#Context"><span class="hs-identifier hs-type">Context</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-451"></a><a name="writeLowCardinality"><a href="ClickHouseDriver.Core.Column.html#writeLowCardinality"><span class="hs-identifier">writeLowCardinality</span></a></a><span> </span><a name="local-6989586621679133163"><a href="#local-6989586621679133163"><span class="hs-identifier">ctx</span></a></a><span> </span><a name="local-6989586621679133164"><a href="#local-6989586621679133164"><span class="hs-identifier">col_name</span></a></a><span> </span><a name="local-6989586621679133165"><a href="#local-6989586621679133165"><span class="hs-identifier">spec</span></a></a><span> </span><a name="local-6989586621679133166"><a href="#local-6989586621679133166"><span class="hs-identifier">items</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-452"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133229"><a href="#local-6989586621679133229"><span class="hs-identifier">inner</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679133165"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">15</span><span> </span><a href="#local-6989586621679133165"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-453"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679133239"><a href="#local-6989586621679133239"><span class="hs-identifier">keys</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679133240"><a href="#local-6989586621679133240"><span class="hs-identifier">index</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-454"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-string">&quot;Nullable&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679133229"><span class="hs-identifier hs-var">inner</span></a><span>
</span><a name="line-455"></a><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-456"></a><span>        </span><span class="hs-comment">--let null_inner_spec = BS.take (BS.length inner - 10) (BS.drop 9 spec)</span><span>
</span><a name="line-457"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133230"><a href="#local-6989586621679133230"><span class="hs-identifier">hashedItem</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679133168"><span class="hs-identifier hs-var">hashItems</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679133166"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-458"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133231"><a href="#local-6989586621679133231"><span class="hs-identifier">key_by_index_element</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.foldl'</span><span> </span><a href="#local-6989586621679133167"><span class="hs-identifier hs-var">insertKeys</span></a><span> </span><span class="hs-identifier hs-var">Map.empty</span><span> </span><a href="#local-6989586621679133230"><span class="hs-identifier hs-var">hashedItem</span></a><span>
</span><a name="line-459"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133232"><a href="#local-6989586621679133232"><span class="hs-identifier">keys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679133233"><a href="#local-6989586621679133233"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679133231"><span class="hs-identifier hs-var">key_by_index_element</span></a><span> </span><span class="hs-operator hs-var">Map.!</span><span> </span><a href="#local-6989586621679133233"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679133230"><span class="hs-identifier hs-var">hashedItem</span></a><span>
</span><a name="line-460"></a><span>        </span><span class="hs-comment">-- First element is NULL if column is nullable</span><span>
</span><a name="line-461"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133234"><a href="#local-6989586621679133234"><span class="hs-identifier">index</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.keys</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679133231"><span class="hs-identifier hs-var">key_by_index_element</span></a><span class="hs-special">)</span><span>
</span><a name="line-462"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679133232"><span class="hs-identifier hs-var">keys</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679133234"><span class="hs-identifier hs-var">index</span></a><span class="hs-special">)</span><span>
</span><a name="line-463"></a><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-464"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133235"><a href="#local-6989586621679133235"><span class="hs-identifier">hashedItem</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679133168"><span class="hs-identifier hs-var">hashItems</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621679133166"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-465"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133236"><a href="#local-6989586621679133236"><span class="hs-identifier">key_by_index_element</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.foldl'</span><span> </span><a href="#local-6989586621679133167"><span class="hs-identifier hs-var">insertKeys</span></a><span> </span><span class="hs-identifier hs-var">Map.empty</span><span> </span><a href="#local-6989586621679133235"><span class="hs-identifier hs-var">hashedItem</span></a><span>
</span><a name="line-466"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133237"><a href="#local-6989586621679133237"><span class="hs-identifier">keys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679133236"><span class="hs-identifier hs-var">key_by_index_element</span></a><span> </span><span class="hs-operator hs-var">Map.!</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679133235"><span class="hs-identifier hs-var">hashedItem</span></a><span>
</span><a name="line-467"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133238"><a href="#local-6989586621679133238"><span class="hs-identifier">index</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Map.keys</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679133236"><span class="hs-identifier hs-var">key_by_index_element</span></a><span>
</span><a name="line-468"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679133237"><span class="hs-identifier hs-var">keys</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679133238"><span class="hs-identifier hs-var">index</span></a><span class="hs-special">)</span><span>
</span><a name="line-469"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">V.length</span><span> </span><a href="#local-6989586621679133240"><span class="hs-identifier hs-var">index</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-470"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-471"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-472"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133241"><a href="#local-6989586621679133241"><span class="hs-identifier">int_type</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">floor</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">logBase</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.length</span><span> </span><a href="#local-6989586621679133240"><span class="hs-identifier hs-var">index</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">/</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int64</span><span>
</span><a name="line-473"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133242"><a href="#local-6989586621679133242"><span class="hs-identifier">has_additional_keys_bit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shift</span><span class="hs-special">`</span><span> </span><span class="hs-number">9</span><span>
</span><a name="line-474"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133243"><a href="#local-6989586621679133243"><span class="hs-identifier">need_update_dictionary</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shift</span><span class="hs-special">`</span><span> </span><span class="hs-number">10</span><span>
</span><a name="line-475"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133244"><a href="#local-6989586621679133244"><span class="hs-identifier">serialization_type</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-476"></a><span>            </span><a href="#local-6989586621679133242"><span class="hs-identifier hs-var">has_additional_keys_bit</span></a><span>
</span><a name="line-477"></a><span>              </span><span class="hs-operator hs-var">.|.</span><span> </span><a href="#local-6989586621679133243"><span class="hs-identifier hs-var">need_update_dictionary</span></a><span>
</span><a name="line-478"></a><span>              </span><span class="hs-operator hs-var">.|.</span><span> </span><a href="#local-6989586621679133241"><span class="hs-identifier hs-var">int_type</span></a><span>
</span><a name="line-479"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133245"><a href="#local-6989586621679133245"><span class="hs-identifier">nullsInner</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-480"></a><span>            </span><span class="hs-keyword">if</span><span> </span><span class="hs-string">&quot;Nullable&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679133229"><span class="hs-identifier hs-var">inner</span></a><span>
</span><a name="line-481"></a><span>              </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679133229"><span class="hs-identifier hs-var">inner</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">10</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">9</span><span> </span><a href="#local-6989586621679133165"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-482"></a><span>              </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679133229"><span class="hs-identifier hs-var">inner</span></a><span>
</span><a name="line-483"></a><span>      </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt64"><span class="hs-identifier hs-var">writeBinaryUInt64</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-comment">--state prefix</span><span>
</span><a name="line-484"></a><span>      </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt64"><span class="hs-identifier hs-var">writeBinaryInt64</span></a><span> </span><a href="#local-6989586621679133244"><span class="hs-identifier hs-var">serialization_type</span></a><span>
</span><a name="line-485"></a><span>      </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt64"><span class="hs-identifier hs-var">writeBinaryInt64</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.length</span><span> </span><a href="#local-6989586621679133240"><span class="hs-identifier hs-var">index</span></a><span>
</span><a name="line-486"></a><span>      </span><a href="ClickHouseDriver.Core.Column.html#writeColumn"><span class="hs-identifier hs-var">writeColumn</span></a><span> </span><a href="#local-6989586621679133163"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="#local-6989586621679133164"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679133245"><span class="hs-identifier hs-var">nullsInner</span></a><span> </span><a href="#local-6989586621679133166"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-487"></a><span>      </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt64"><span class="hs-identifier hs-var">writeBinaryInt64</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.length</span><span> </span><a href="#local-6989586621679133166"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-488"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679133241"><span class="hs-identifier hs-var">int_type</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-489"></a><span>        </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">V.mapM_</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt8"><span class="hs-identifier hs-var">writeBinaryUInt8</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679133239"><span class="hs-identifier hs-var">keys</span></a><span>
</span><a name="line-490"></a><span>        </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">V.mapM_</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt16"><span class="hs-identifier hs-var">writeBinaryUInt16</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679133239"><span class="hs-identifier hs-var">keys</span></a><span>
</span><a name="line-491"></a><span>        </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">V.mapM_</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt32"><span class="hs-identifier hs-var">writeBinaryUInt32</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679133239"><span class="hs-identifier hs-var">keys</span></a><span>
</span><a name="line-492"></a><span>        </span><span class="hs-number">3</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">V.mapM_</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt64"><span class="hs-identifier hs-var">writeBinaryUInt64</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679133239"><span class="hs-identifier hs-var">keys</span></a><span>
</span><a name="line-493"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-494"></a><span>    </span><span class="hs-identifier">insertKeys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679133169"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679133169"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Map.HashMap</span><span> </span><a href="#local-6989586621679133169"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679133169"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map.HashMap</span><span> </span><a href="#local-6989586621679133169"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-495"></a><span>    </span><a name="local-6989586621679133167"><a href="#local-6989586621679133167"><span class="hs-identifier">insertKeys</span></a></a><span> </span><a name="local-6989586621679133170"><a href="#local-6989586621679133170"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679133171"><a href="#local-6989586621679133171"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">Map.member</span><span> </span><a href="#local-6989586621679133171"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679133170"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679133170"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Map.insert</span><span> </span><a href="#local-6989586621679133171"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.size</span><span> </span><a href="#local-6989586621679133170"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679133170"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-496"></a><span>
</span><a name="line-497"></a><span>    </span><span class="hs-identifier">hashItems</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-498"></a><span>    </span><a name="local-6989586621679133168"><a href="#local-6989586621679133168"><span class="hs-identifier">hashItems</span></a></a><span> </span><a name="local-6989586621679133218"><a href="#local-6989586621679133218"><span class="hs-identifier">isNullable</span></a></a><span> </span><a name="local-6989586621679133219"><a href="#local-6989586621679133219"><span class="hs-identifier">items</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-499"></a><span>      </span><span class="hs-identifier hs-var">V.map</span><span>
</span><a name="line-500"></a><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-501"></a><span>            </span><a href="ClickHouseDriver.Core.Types.html#CKInt16"><span class="hs-identifier hs-var">CKInt16</span></a><span> </span><a name="local-6989586621679133220"><a href="#local-6989586621679133220"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">hash</span><span> </span><a href="#local-6989586621679133220"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-502"></a><span>            </span><a href="ClickHouseDriver.Core.Types.html#CKInt8"><span class="hs-identifier hs-var">CKInt8</span></a><span> </span><a name="local-6989586621679133221"><a href="#local-6989586621679133221"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">hash</span><span> </span><a href="#local-6989586621679133221"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-503"></a><span>            </span><a href="ClickHouseDriver.Core.Types.html#CKInt32"><span class="hs-identifier hs-var">CKInt32</span></a><span> </span><a name="local-6989586621679133222"><a href="#local-6989586621679133222"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">hash</span><span> </span><a href="#local-6989586621679133222"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-504"></a><span>            </span><a href="ClickHouseDriver.Core.Types.html#CKInt64"><span class="hs-identifier hs-var">CKInt64</span></a><span> </span><a name="local-6989586621679133223"><a href="#local-6989586621679133223"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">hash</span><span> </span><a href="#local-6989586621679133223"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-505"></a><span>            </span><a href="ClickHouseDriver.Core.Types.html#CKUInt8"><span class="hs-identifier hs-var">CKUInt8</span></a><span> </span><a name="local-6989586621679133224"><a href="#local-6989586621679133224"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">hash</span><span> </span><a href="#local-6989586621679133224"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-506"></a><span>            </span><a href="ClickHouseDriver.Core.Types.html#CKUInt16"><span class="hs-identifier hs-var">CKUInt16</span></a><span> </span><a name="local-6989586621679133225"><a href="#local-6989586621679133225"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">hash</span><span> </span><a href="#local-6989586621679133225"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-507"></a><span>            </span><a href="ClickHouseDriver.Core.Types.html#CKUInt32"><span class="hs-identifier hs-var">CKUInt32</span></a><span> </span><a name="local-6989586621679133226"><a href="#local-6989586621679133226"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">hash</span><span> </span><a href="#local-6989586621679133226"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-508"></a><span>            </span><a href="ClickHouseDriver.Core.Types.html#CKUInt64"><span class="hs-identifier hs-var">CKUInt64</span></a><span> </span><a name="local-6989586621679133227"><a href="#local-6989586621679133227"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">hash</span><span> </span><a href="#local-6989586621679133227"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-509"></a><span>            </span><a href="ClickHouseDriver.Core.Types.html#CKString"><span class="hs-identifier hs-var">CKString</span></a><span> </span><a name="local-6989586621679133228"><a href="#local-6989586621679133228"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">hash</span><span> </span><a href="#local-6989586621679133228"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-510"></a><span>            </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-511"></a><span>              </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679133218"><span class="hs-identifier hs-var">isNullable</span></a><span>
</span><a name="line-512"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">hash</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-513"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679133164"><span class="hs-identifier hs-var">col_name</span></a><span>
</span><a name="line-514"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679133164"><span class="hs-identifier hs-var">col_name</span></a><span>
</span><a name="line-515"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-516"></a><span>        </span><a href="#local-6989586621679133219"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-517"></a><span>
</span><a name="line-518"></a><span class="hs-comment">---------------------------------------------------------------------------------------------------------------------------------</span><span>
</span><a name="line-519"></a><span class="hs-comment">{-
          Informal description (in terms of regular expression form) for this config:
          (\Null | \SOH)^{n_rows}
          \Null means null and \SOH which equals 1 means not null. The `|` in the middle means or.
-}</span><span>
</span><a name="line-524"></a><span class="hs-identifier">readNullable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ServerInfo"><span class="hs-identifier hs-type">ServerInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-525"></a><a name="readNullable"><a href="ClickHouseDriver.Core.Column.html#readNullable"><span class="hs-identifier">readNullable</span></a></a><span> </span><a name="local-6989586621679133246"><a href="#local-6989586621679133246"><span class="hs-identifier">server_info</span></a></a><span> </span><a name="local-6989586621679133247"><a href="#local-6989586621679133247"><span class="hs-identifier">n_rows</span></a></a><span> </span><a name="local-6989586621679133248"><a href="#local-6989586621679133248"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-526"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133252"><a href="#local-6989586621679133252"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679133248"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-527"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133253"><a href="#local-6989586621679133253"><span class="hs-identifier">cktype</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679133252"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">10</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">9</span><span> </span><a href="#local-6989586621679133248"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Read Clickhouse type inside the bracket after the 'Nullable' spec.</span><span>
</span><a name="line-528"></a><span>  </span><a name="local-6989586621679133254"><a href="#local-6989586621679133254"><span class="hs-identifier">config</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679133249"><span class="hs-identifier hs-var">readNullableConfig</span></a><span> </span><a href="#local-6989586621679133247"><span class="hs-identifier hs-var">n_rows</span></a><span>
</span><a name="line-529"></a><span>  </span><a name="local-6989586621679133255"><a href="#local-6989586621679133255"><span class="hs-identifier">items</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readColumn"><span class="hs-identifier hs-var">readColumn</span></a><span> </span><a href="#local-6989586621679133246"><span class="hs-identifier hs-var">server_info</span></a><span> </span><a href="#local-6989586621679133247"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="#local-6989586621679133253"><span class="hs-identifier hs-var">cktype</span></a><span>
</span><a name="line-530"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133256"><a href="#local-6989586621679133256"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.generate</span><span> </span><a href="#local-6989586621679133247"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679133257"><a href="#local-6989586621679133257"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679133254"><span class="hs-identifier hs-var">config</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679133257"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679133255"><span class="hs-identifier hs-var">items</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621679133257"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-531"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679133256"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-532"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-533"></a><span>    </span><span class="hs-identifier">readNullableConfig</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span>
</span><a name="line-534"></a><span>    </span><a name="local-6989586621679133249"><a href="#local-6989586621679133249"><span class="hs-identifier">readNullableConfig</span></a></a><span> </span><a name="local-6989586621679133250"><a href="#local-6989586621679133250"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-535"></a><span>      </span><a name="local-6989586621679133251"><a href="#local-6989586621679133251"><span class="hs-identifier">config</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryStrWithLength"><span class="hs-identifier hs-var">readBinaryStrWithLength</span></a><span> </span><a href="#local-6989586621679133250"><span class="hs-identifier hs-var">n_rows</span></a><span>
</span><a name="line-536"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">V.fromList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">BS.unpack</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679133251"><span class="hs-identifier hs-var">config</span></a><span>
</span><a name="line-537"></a><span>
</span><a name="line-538"></a><span class="hs-identifier">writeNullable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ClickHouseDriver.Core.Types.html#Context"><span class="hs-identifier hs-type">Context</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-539"></a><a name="writeNullable"><a href="ClickHouseDriver.Core.Column.html#writeNullable"><span class="hs-identifier">writeNullable</span></a></a><span> </span><a name="local-6989586621679133258"><a href="#local-6989586621679133258"><span class="hs-identifier">ctx</span></a></a><span> </span><a name="local-6989586621679133259"><a href="#local-6989586621679133259"><span class="hs-identifier">col_name</span></a></a><span> </span><a name="local-6989586621679133260"><a href="#local-6989586621679133260"><span class="hs-identifier">spec</span></a></a><span> </span><a name="local-6989586621679133261"><a href="#local-6989586621679133261"><span class="hs-identifier">items</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-540"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133263"><a href="#local-6989586621679133263"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679133260"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-541"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133264"><a href="#local-6989586621679133264"><span class="hs-identifier">inner</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679133263"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">10</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">9</span><span> </span><a href="#local-6989586621679133260"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-542"></a><span>  </span><a href="#local-6989586621679133262"><span class="hs-identifier hs-var">writeNullsMap</span></a><span> </span><a href="#local-6989586621679133261"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-543"></a><span>  </span><a href="ClickHouseDriver.Core.Column.html#writeColumn"><span class="hs-identifier hs-var">writeColumn</span></a><span> </span><a href="#local-6989586621679133258"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="#local-6989586621679133259"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679133264"><span class="hs-identifier hs-var">inner</span></a><span> </span><a href="#local-6989586621679133261"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-544"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-545"></a><span>    </span><span class="hs-identifier">writeNullsMap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-546"></a><span>    </span><a name="local-6989586621679133262"><a href="#local-6989586621679133262"><span class="hs-identifier">writeNullsMap</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-547"></a><span>      </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-548"></a><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-549"></a><span>            </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt8"><span class="hs-identifier hs-var">writeBinaryInt8</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-550"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt8"><span class="hs-identifier hs-var">writeBinaryInt8</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-551"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-552"></a><span>
</span><a name="line-553"></a><span class="hs-comment">---------------------------------------------------------------------------------------------------------------------------------</span><span>
</span><a name="line-554"></a><span class="hs-comment">{-
  Format:
  &quot;
     One element of array of arrays can be represented as tree:
      (0 depth)          [[3, 4], [5, 6]]
                        |               |
      (1 depth)      [3, 4]           [5, 6]
                    |    |           |    |
      (leaf)        3     4          5     6
      Offsets (sizes) written in breadth-first search order. In example above
      following sequence of offset will be written: 4 -&gt; 2 -&gt; 4
      1) size of whole array: 4
      2) size of array 1 in depth=1: 2
      3) size of array 2 plus size of all array before in depth=1: 2 + 2 = 4
      After sizes info comes flatten data: 3 -&gt; 4 -&gt; 5 -&gt; 6
  &quot;
      Quoted from https://github.com/mymarilyn/clickhouse-driver/blob/master/clickhouse_driver/columns/arraycolumn.py

Here we don't implement in the form of BFS; instead, we use bottom up method:
First off, we compute the array of integer in which elements represent the size of subarrays (we call them spec arrays)
, where the function `readArraySpec`, `cut`, and `intervalize` do their jobs.
Second, we place the array of atomic elements (or flatten data) at the last position.
Then we cut the array of atomic elements according to the last spec array and form nested a nested array.
Finally we pop out the last spec array.
Repeat this process until all spec arrays are gone.

For example:
The target array is [[3, 4], [5, 6]]
The array on the right hand side of `|` is array of atomic elements.
The algorithm would be like this:
[2] [2,2] | [3,4,5,6]
-&gt; [2] | [[3,4],[5,6]]
-&gt; [[3,4],[5,6]]

For another example:
   target [[[&quot;Alex&quot;,&quot;Bob&quot;], [&quot;John&quot;]],[[&quot;Jane&quot;],[&quot;Steven&quot;,&quot;Mike&quot;,&quot;Sarah&quot;]],[[&quot;Hello&quot;,&quot;world&quot;]]]
   [3] [2,2,1] [2,1,1,3,2] | [&quot;Alex&quot;,&quot;Bob&quot;,&quot;John&quot;,&quot;Jane&quot;,&quot;Steven&quot;,&quot;Mike&quot;,&quot;Sarah&quot;,&quot;Hello&quot;,&quot;world&quot;]
-&gt; [3] [2,2,1] | [[&quot;Alex&quot;,&quot;Bob&quot;],[&quot;John&quot;],[&quot;Jane&quot;],[&quot;Steven&quot;,&quot;Mike&quot;,&quot;Sarah&quot;],[&quot;Hello&quot;,&quot;world&quot;]]
-&gt; [3] | [[[&quot;Alex&quot;,&quot;Bob&quot;],[&quot;John&quot;]],[[&quot;Jane&quot;],[&quot;Steven&quot;,&quot;Mike&quot;,&quot;Sarah&quot;]],[[&quot;Hello&quot;,&quot;world&quot;]]]
-&gt; [[[&quot;Alex&quot;,&quot;Bob&quot;],[&quot;John&quot;]],[[&quot;Jane&quot;],[&quot;Steven&quot;,&quot;Mike&quot;,&quot;Sarah&quot;]],[[&quot;Hello&quot;,&quot;world&quot;]]]

-}</span><span>
</span><a name="line-596"></a><span class="hs-identifier">readArray</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ServerInfo"><span class="hs-identifier hs-type">ServerInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-597"></a><a name="readArray"><a href="ClickHouseDriver.Core.Column.html#readArray"><span class="hs-identifier">readArray</span></a></a><span> </span><a name="local-6989586621679133265"><a href="#local-6989586621679133265"><span class="hs-identifier">server_info</span></a></a><span> </span><a name="local-6989586621679133266"><a href="#local-6989586621679133266"><span class="hs-identifier">n_rows</span></a></a><span> </span><a name="local-6989586621679133267"><a href="#local-6989586621679133267"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-598"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679133282"><a href="#local-6989586621679133282"><span class="hs-identifier">lastSpec</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679133283"><a href="#local-6989586621679133283"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679133284"><a href="#local-6989586621679133284"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ClickHouseDriver.Core.Column.html#genSpecs"><span class="hs-identifier hs-var">genSpecs</span></a><span> </span><a href="#local-6989586621679133267"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">V.fromList</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679133266"><span class="hs-identifier hs-var">n_rows</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-599"></a><span>  </span><span class="hs-comment">--  lastSpec which is not `Array`</span><span>
</span><a name="line-600"></a><span>  </span><span class="hs-comment">--  x:xs is the</span><span>
</span><a name="line-601"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133285"><a href="#local-6989586621679133285"><span class="hs-identifier">numElem</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.sum</span><span> </span><a href="#local-6989586621679133283"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-comment">-- number of elements in the nested array.</span><span>
</span><a name="line-602"></a><span>  </span><a name="local-6989586621679133286"><a href="#local-6989586621679133286"><span class="hs-identifier">elems</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readColumn"><span class="hs-identifier hs-var">readColumn</span></a><span> </span><a href="#local-6989586621679133265"><span class="hs-identifier hs-var">server_info</span></a><span> </span><a href="#local-6989586621679133285"><span class="hs-identifier hs-var">numElem</span></a><span> </span><a href="#local-6989586621679133282"><span class="hs-identifier hs-var">lastSpec</span></a><span>
</span><a name="line-603"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133287"><a href="#local-6989586621679133287"><span class="hs-identifier">result'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl</span><span> </span><a href="#local-6989586621679133268"><span class="hs-identifier hs-var">combine</span></a><span> </span><a href="#local-6989586621679133286"><span class="hs-identifier hs-var">elems</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679133283"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679133284"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-604"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a href="ClickHouseDriver.Core.Types.html#CKArray"><span class="hs-identifier hs-var">CKArray</span></a><span> </span><a name="local-6989586621679134405"><a href="#local-6989586621679134405"><span class="hs-identifier">arr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679133287"><span class="hs-identifier hs-var">result'</span></a><span> </span><span class="hs-glyph">!</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-605"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679134405"><span class="hs-identifier hs-var">arr</span></a><span>
</span><a name="line-606"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-607"></a><span>    </span><span class="hs-identifier">combine</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span>
</span><a name="line-608"></a><span>    </span><a name="local-6989586621679133268"><a href="#local-6989586621679133268"><span class="hs-identifier">combine</span></a></a><span> </span><a name="local-6989586621679133270"><a href="#local-6989586621679133270"><span class="hs-identifier">elems</span></a></a><span> </span><a name="local-6989586621679133271"><a href="#local-6989586621679133271"><span class="hs-identifier">config</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-609"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679133272"><a href="#local-6989586621679133272"><span class="hs-identifier">intervals</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679133269"><span class="hs-identifier hs-var">intervalize</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679133271"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">)</span><span>
</span><a name="line-610"></a><span>          </span><a name="local-6989586621679133273"><a href="#local-6989586621679133273"><span class="hs-identifier">cut</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679133275"><a href="#local-6989586621679133275"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679133276"><a href="#local-6989586621679133276"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Types.html#CKArray"><span class="hs-identifier hs-var">CKArray</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.take</span><span> </span><a href="#local-6989586621679133276"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">V.drop</span><span> </span><a href="#local-6989586621679133275"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679133270"><span class="hs-identifier hs-var">elems</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- cut element array</span><span>
</span><a name="line-611"></a><span>          </span><a name="local-6989586621679133274"><a href="#local-6989586621679133274"><span class="hs-identifier">embed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679133277"><a href="#local-6989586621679133277"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679133278"><a href="#local-6989586621679133278"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679133273"><span class="hs-identifier hs-var">cut</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679133277"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679133278"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679133277"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679133272"><span class="hs-identifier hs-var">intervals</span></a><span>
</span><a name="line-612"></a><span>       </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679133274"><span class="hs-identifier hs-var">embed</span></a><span>
</span><a name="line-613"></a><span>    </span><span class="hs-identifier">intervalize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-614"></a><span>    </span><a name="local-6989586621679133269"><a href="#local-6989586621679133269"><span class="hs-identifier">intervalize</span></a></a><span> </span><a name="local-6989586621679133279"><a href="#local-6989586621679133279"><span class="hs-identifier">vec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.drop</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.scanl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679133280"><a href="#local-6989586621679133280"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679133281"><a href="#local-6989586621679133281"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679133280"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679133281"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679133280"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679133279"><span class="hs-identifier hs-var">vec</span></a><span> </span><span class="hs-comment">-- drop the first tuple (-1,-1)</span><span>
</span><a name="line-615"></a><span>
</span><a name="line-616"></a><span class="hs-identifier">readArraySpec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-617"></a><a name="readArraySpec"><a href="ClickHouseDriver.Core.Column.html#readArraySpec"><span class="hs-identifier">readArraySpec</span></a></a><span> </span><a name="local-6989586621679134406"><a href="#local-6989586621679134406"><span class="hs-identifier">sizeArr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-618"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134407"><a href="#local-6989586621679134407"><span class="hs-identifier">arrSum</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">V.sum</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679134406"><span class="hs-identifier hs-var">sizeArr</span></a><span>
</span><a name="line-619"></a><span>  </span><a name="local-6989586621679134408"><a href="#local-6989586621679134408"><span class="hs-identifier">offsets</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679134407"><span class="hs-identifier hs-var">arrSum</span></a><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt64"><span class="hs-identifier hs-var">readBinaryUInt64</span></a><span>
</span><a name="line-620"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134409"><a href="#local-6989586621679134409"><span class="hs-identifier">offsets'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.cons</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">V.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134407"><span class="hs-identifier hs-var">arrSum</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679134408"><span class="hs-identifier hs-var">offsets</span></a><span class="hs-special">)</span><span>
</span><a name="line-621"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134410"><a href="#local-6989586621679134410"><span class="hs-identifier">sizes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.zipWith</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679134408"><span class="hs-identifier hs-var">offsets</span></a><span> </span><a href="#local-6989586621679134409"><span class="hs-identifier hs-var">offsets'</span></a><span>
</span><a name="line-622"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679134410"><span class="hs-identifier hs-var">sizes</span></a><span>
</span><a name="line-623"></a><span>
</span><a name="line-624"></a><span class="hs-identifier">genSpecs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-625"></a><a name="genSpecs"><a href="ClickHouseDriver.Core.Column.html#genSpecs"><span class="hs-identifier">genSpecs</span></a></a><span> </span><a name="local-6989586621679134411"><a href="#local-6989586621679134411"><span class="hs-identifier">spec</span></a></a><span> </span><a name="local-6989586621679134412"><a href="#local-6989586621679134412"><span class="hs-identifier">rest</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679134413"><a href="#local-6989586621679134413"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-626"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134414"><a href="#local-6989586621679134414"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679134411"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-627"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134415"><a href="#local-6989586621679134415"><span class="hs-identifier">cktype</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134414"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">7</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">6</span><span> </span><a href="#local-6989586621679134411"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-628"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-string">&quot;Array&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679134411"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-629"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-630"></a><span>      </span><a name="local-6989586621679134416"><a href="#local-6989586621679134416"><span class="hs-identifier">next</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readArraySpec"><span class="hs-identifier hs-var">readArraySpec</span></a><span> </span><a href="#local-6989586621679134413"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-631"></a><span>      </span><a href="ClickHouseDriver.Core.Column.html#genSpecs"><span class="hs-identifier hs-var">genSpecs</span></a><span> </span><a href="#local-6989586621679134415"><span class="hs-identifier hs-var">cktype</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134416"><span class="hs-identifier hs-var">next</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679134412"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">)</span><span>
</span><a name="line-632"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134411"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679134412"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">)</span><span>
</span><a name="line-633"></a><span>
</span><a name="line-634"></a><span class="hs-identifier">writeArray</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ClickHouseDriver.Core.Types.html#Context"><span class="hs-identifier hs-type">Context</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-635"></a><a name="writeArray"><a href="ClickHouseDriver.Core.Column.html#writeArray"><span class="hs-identifier">writeArray</span></a></a><span> </span><a name="local-6989586621679134417"><a href="#local-6989586621679134417"><span class="hs-identifier">ctx</span></a></a><span> </span><a name="local-6989586621679134418"><a href="#local-6989586621679134418"><span class="hs-identifier">col_name</span></a></a><span> </span><a name="local-6989586621679134419"><a href="#local-6989586621679134419"><span class="hs-identifier">spec</span></a></a><span> </span><a name="local-6989586621679134420"><a href="#local-6989586621679134420"><span class="hs-identifier">items</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-636"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134421"><a href="#local-6989586621679134421"><span class="hs-identifier">lens</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-637"></a><span>        </span><span class="hs-identifier hs-var">V.scanl'</span><span>
</span><a name="line-638"></a><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679134422"><a href="#local-6989586621679134422"><span class="hs-identifier">total</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-639"></a><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-640"></a><span>                  </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKArray"><span class="hs-identifier hs-var">CKArray</span></a><span> </span><a name="local-6989586621679134423"><a href="#local-6989586621679134423"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679134422"><span class="hs-identifier hs-var">total</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">V.length</span><span> </span><a href="#local-6989586621679134423"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-641"></a><span>                  </span><a name="local-6989586621679134424"><a href="#local-6989586621679134424"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-642"></a><span>                    </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-643"></a><span>                      </span><span class="hs-string">&quot;unexpected type in the column: &quot;</span><span>
</span><a name="line-644"></a><span>                        </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134418"><span class="hs-identifier hs-var">col_name</span></a><span>
</span><a name="line-645"></a><span>                        </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; with data&quot;</span><span>
</span><a name="line-646"></a><span>                        </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134424"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-647"></a><span>              </span><span class="hs-special">)</span><span>
</span><a name="line-648"></a><span>          </span><span class="hs-special">)</span><span>
</span><a name="line-649"></a><span>          </span><span class="hs-number">0</span><span>
</span><a name="line-650"></a><span>          </span><a href="#local-6989586621679134420"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-651"></a><span>  </span><span class="hs-identifier hs-var">V.mapM_</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt64"><span class="hs-identifier hs-var">writeBinaryInt64</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">V.drop</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621679134421"><span class="hs-identifier hs-var">lens</span></a><span class="hs-special">)</span><span>
</span><a name="line-652"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134425"><a href="#local-6989586621679134425"><span class="hs-identifier">innerSpec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679134419"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">7</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">6</span><span> </span><a href="#local-6989586621679134419"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-653"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134426"><a href="#local-6989586621679134426"><span class="hs-identifier">innerVector</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span> </span><a href="ClickHouseDriver.Core.Types.html#CKArray"><span class="hs-identifier hs-var">CKArray</span></a><span> </span><a name="local-6989586621679134427"><a href="#local-6989586621679134427"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679134427"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679134420"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-654"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134428"><a href="#local-6989586621679134428"><span class="hs-identifier">flattenVector</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-655"></a><span>        </span><a href="#local-6989586621679134426"><span class="hs-identifier hs-var">innerVector</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679134429"><a href="#local-6989586621679134429"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="#local-6989586621679134429"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-656"></a><span>  </span><a href="ClickHouseDriver.Core.Column.html#writeColumn"><span class="hs-identifier hs-var">writeColumn</span></a><span> </span><a href="#local-6989586621679134417"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="#local-6989586621679134418"><span class="hs-identifier hs-var">col_name</span></a><span> </span><a href="#local-6989586621679134425"><span class="hs-identifier hs-var">innerSpec</span></a><span> </span><a href="#local-6989586621679134428"><span class="hs-identifier hs-var">flattenVector</span></a><span>
</span><a name="line-657"></a><span>
</span><a name="line-658"></a><span class="hs-comment">--------------------------------------------------------------------------------------</span><span>
</span><a name="line-659"></a><span class="hs-identifier">readTuple</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ServerInfo"><span class="hs-identifier hs-type">ServerInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-660"></a><a name="readTuple"><a href="ClickHouseDriver.Core.Column.html#readTuple"><span class="hs-identifier">readTuple</span></a></a><span> </span><a name="local-6989586621679134430"><a href="#local-6989586621679134430"><span class="hs-identifier">server_info</span></a></a><span> </span><a name="local-6989586621679134431"><a href="#local-6989586621679134431"><span class="hs-identifier">n_rows</span></a></a><span> </span><a name="local-6989586621679134432"><a href="#local-6989586621679134432"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-661"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134433"><a href="#local-6989586621679134433"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679134432"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-662"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134434"><a href="#local-6989586621679134434"><span class="hs-identifier">innerSpecString</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134433"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">7</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">6</span><span> </span><a href="#local-6989586621679134432"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Tuple(...) the dots represent innerSpecString</span><span>
</span><a name="line-663"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134435"><a href="#local-6989586621679134435"><span class="hs-identifier">arr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.fromList</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#getSpecs"><span class="hs-identifier hs-var">getSpecs</span></a><span> </span><a href="#local-6989586621679134434"><span class="hs-identifier hs-var">innerSpecString</span></a><span class="hs-special">)</span><span>
</span><a name="line-664"></a><span>  </span><a name="local-6989586621679134436"><a href="#local-6989586621679134436"><span class="hs-identifier">datas</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">V.mapM</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#readColumn"><span class="hs-identifier hs-var">readColumn</span></a><span> </span><a href="#local-6989586621679134430"><span class="hs-identifier hs-var">server_info</span></a><span> </span><a href="#local-6989586621679134431"><span class="hs-identifier hs-var">n_rows</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679134435"><span class="hs-identifier hs-var">arr</span></a><span>
</span><a name="line-665"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134437"><a href="#local-6989586621679134437"><span class="hs-identifier">transposed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#transpose"><span class="hs-identifier hs-var">transpose</span></a><span> </span><a href="#local-6989586621679134436"><span class="hs-identifier hs-var">datas</span></a><span>
</span><a name="line-666"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Types.html#CKTuple"><span class="hs-identifier hs-var">CKTuple</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679134437"><span class="hs-identifier hs-var">transposed</span></a><span>
</span><a name="line-667"></a><span>
</span><a name="line-668"></a><span class="hs-identifier">writeTuple</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ClickHouseDriver.Core.Types.html#Context"><span class="hs-identifier hs-type">Context</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-669"></a><a name="writeTuple"><a href="ClickHouseDriver.Core.Column.html#writeTuple"><span class="hs-identifier">writeTuple</span></a></a><span> </span><a name="local-6989586621679134438"><a href="#local-6989586621679134438"><span class="hs-identifier">ctx</span></a></a><span> </span><a name="local-6989586621679134439"><a href="#local-6989586621679134439"><span class="hs-identifier">col_name</span></a></a><span> </span><a name="local-6989586621679134440"><a href="#local-6989586621679134440"><span class="hs-identifier">spec</span></a></a><span> </span><a name="local-6989586621679134441"><a href="#local-6989586621679134441"><span class="hs-identifier">items</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-670"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134442"><a href="#local-6989586621679134442"><span class="hs-identifier">inner</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679134440"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">7</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">6</span><span> </span><a href="#local-6989586621679134440"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-671"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134443"><a href="#local-6989586621679134443"><span class="hs-identifier">spec_arr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Column.html#getSpecs"><span class="hs-identifier hs-var">getSpecs</span></a><span> </span><a href="#local-6989586621679134442"><span class="hs-identifier hs-var">inner</span></a><span>
</span><a name="line-672"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134444"><a href="#local-6989586621679134444"><span class="hs-identifier">transposed</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-673"></a><span>        </span><a href="ClickHouseDriver.Core.Column.html#transpose"><span class="hs-identifier hs-var">transpose</span></a><span>
</span><a name="line-674"></a><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">V.map</span><span>
</span><a name="line-675"></a><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-676"></a><span>                  </span><a href="ClickHouseDriver.Core.Types.html#CKTuple"><span class="hs-identifier hs-var">CKTuple</span></a><span> </span><a name="local-6989586621679134445"><a href="#local-6989586621679134445"><span class="hs-identifier">tupleVec</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679134445"><span class="hs-identifier hs-var">tupleVec</span></a><span>
</span><a name="line-677"></a><span>                  </span><a name="local-6989586621679134446"><a href="#local-6989586621679134446"><span class="hs-identifier">other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-678"></a><span>                    </span><span class="hs-identifier hs-var">error</span><span>
</span><a name="line-679"></a><span>                      </span><span class="hs-special">(</span><span> </span><span class="hs-string">&quot;expected type: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134446"><span class="hs-identifier hs-var">other</span></a><span>
</span><a name="line-680"></a><span>                          </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;in the column:&quot;</span><span>
</span><a name="line-681"></a><span>                          </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134439"><span class="hs-identifier hs-var">col_name</span></a><span>
</span><a name="line-682"></a><span>                      </span><span class="hs-special">)</span><span>
</span><a name="line-683"></a><span>              </span><span class="hs-special">)</span><span>
</span><a name="line-684"></a><span>              </span><a href="#local-6989586621679134441"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-685"></a><span>          </span><span class="hs-special">)</span><span>
</span><a name="line-686"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">V.length</span><span> </span><a href="#local-6989586621679134443"><span class="hs-identifier hs-var">spec_arr</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier hs-var">V.length</span><span> </span><a href="#local-6989586621679134444"><span class="hs-identifier hs-var">transposed</span></a><span>
</span><a name="line-687"></a><span>    </span><span class="hs-keyword">then</span><span>
</span><a name="line-688"></a><span>      </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-689"></a><span>        </span><span class="hs-string">&quot;length of the given array does not match, column name = &quot;</span><span>
</span><a name="line-690"></a><span>          </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134439"><span class="hs-identifier hs-var">col_name</span></a><span>
</span><a name="line-691"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-692"></a><span>      </span><span class="hs-identifier hs-var">V.zipWithM_</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#writeColumn"><span class="hs-identifier hs-var">writeColumn</span></a><span> </span><a href="#local-6989586621679134438"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="#local-6989586621679134439"><span class="hs-identifier hs-var">col_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679134443"><span class="hs-identifier hs-var">spec_arr</span></a><span> </span><a href="#local-6989586621679134444"><span class="hs-identifier hs-var">transposed</span></a><span>
</span><a name="line-693"></a><span>
</span><a name="line-694"></a><span class="hs-comment">--------------------------------------------------------------------------------------</span><span>
</span><a name="line-695"></a><span class="hs-identifier">readEnum</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-696"></a><a name="readEnum"><a href="ClickHouseDriver.Core.Column.html#readEnum"><span class="hs-identifier">readEnum</span></a></a><span> </span><a name="local-6989586621679134447"><a href="#local-6989586621679134447"><span class="hs-identifier">n_rows</span></a></a><span> </span><a name="local-6989586621679134448"><a href="#local-6989586621679134448"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-697"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134449"><a href="#local-6989586621679134449"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679134448"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-698"></a><span>      </span><a name="local-6989586621679134450"><a href="#local-6989586621679134450"><span class="hs-identifier">innerSpec</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-699"></a><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-string">&quot;Enum8&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679134448"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-700"></a><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134449"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">7</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">6</span><span> </span><a href="#local-6989586621679134448"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-701"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134449"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">7</span><span> </span><a href="#local-6989586621679134448"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- otherwise it is `Enum16`</span><span>
</span><a name="line-702"></a><span>      </span><a name="local-6989586621679134451"><a href="#local-6989586621679134451"><span class="hs-identifier">pres_pecs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#getSpecs"><span class="hs-identifier hs-var">getSpecs</span></a><span> </span><a href="#local-6989586621679134450"><span class="hs-identifier hs-var">innerSpec</span></a><span>
</span><a name="line-703"></a><span>      </span><a name="local-6989586621679134452"><a href="#local-6989586621679134452"><span class="hs-identifier">specs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-704"></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679134454"><a href="#local-6989586621679134454"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679134455"><a href="#local-6989586621679134455"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134455"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679134454"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-705"></a><span>          </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">[</span><a name="local-6989586621679134456"><a href="#local-6989586621679134456"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134457"><a href="#local-6989586621679134457"><span class="hs-identifier">y</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134456"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679134457"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">BS.splitWith</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">EQUAL</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">pres_pecs</span><span class="hs-special">)</span><span> </span><span class="hs-comment">--61 means '='</span><span>
</span><a name="line-706"></a><span>      </span><a name="local-6989586621679134453"><a href="#local-6989586621679134453"><span class="hs-identifier">specsMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.fromList</span><span> </span><a href="#local-6989586621679134452"><span class="hs-identifier hs-var">specs</span></a><span>
</span><a name="line-707"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-string">&quot;Enum8&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679134448"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-708"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-709"></a><span>      </span><a name="local-6989586621679134458"><a href="#local-6989586621679134458"><span class="hs-identifier">values</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679134447"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryInt8"><span class="hs-identifier hs-var">readBinaryInt8</span></a><span>
</span><a name="line-710"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Types.html#CKString"><span class="hs-identifier hs-var">CKString</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134453"><span class="hs-identifier hs-var">specsMap</span></a><span> </span><span class="hs-operator hs-var">Map.!</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679134458"><span class="hs-identifier hs-var">values</span></a><span>
</span><a name="line-711"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-712"></a><span>      </span><a name="local-6989586621679134459"><a href="#local-6989586621679134459"><span class="hs-identifier">values</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679134447"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryInt16"><span class="hs-identifier hs-var">readBinaryInt16</span></a><span>
</span><a name="line-713"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Types.html#CKString"><span class="hs-identifier hs-var">CKString</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134453"><span class="hs-identifier hs-var">specsMap</span></a><span> </span><span class="hs-operator hs-var">Map.!</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679134459"><span class="hs-identifier hs-var">values</span></a><span>
</span><a name="line-714"></a><span>
</span><a name="line-715"></a><span class="hs-identifier">writeEnum</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-716"></a><a name="writeEnum"><a href="ClickHouseDriver.Core.Column.html#writeEnum"><span class="hs-identifier">writeEnum</span></a></a><span> </span><a name="local-6989586621679134460"><a href="#local-6989586621679134460"><span class="hs-identifier">col_name</span></a></a><span> </span><a name="local-6989586621679134461"><a href="#local-6989586621679134461"><span class="hs-identifier">spec</span></a></a><span> </span><a name="local-6989586621679134462"><a href="#local-6989586621679134462"><span class="hs-identifier">items</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-717"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134463"><a href="#local-6989586621679134463"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679134461"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-718"></a><span>      </span><a name="local-6989586621679134464"><a href="#local-6989586621679134464"><span class="hs-identifier">innerSpec</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-719"></a><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-string">&quot;Enum8&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679134461"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-720"></a><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134463"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">7</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">6</span><span> </span><a href="#local-6989586621679134461"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-721"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134463"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">7</span><span> </span><a href="#local-6989586621679134461"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-722"></a><span>      </span><a name="local-6989586621679134465"><a href="#local-6989586621679134465"><span class="hs-identifier">pres_pecs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#getSpecs"><span class="hs-identifier hs-var">getSpecs</span></a><span> </span><a href="#local-6989586621679134464"><span class="hs-identifier hs-var">innerSpec</span></a><span>
</span><a name="line-723"></a><span>      </span><a name="local-6989586621679134466"><a href="#local-6989586621679134466"><span class="hs-identifier">specs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-724"></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679134468"><a href="#local-6989586621679134468"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679134469"><a href="#local-6989586621679134469"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134468"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679134469"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-725"></a><span>          </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">[</span><a name="local-6989586621679134470"><a href="#local-6989586621679134470"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134471"><a href="#local-6989586621679134471"><span class="hs-identifier">y</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134470"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679134471"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">BS.splitWith</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">EQUAL</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">BS.filter</span><span> </span><span class="hs-special">(</span><span class="hs-operator">/=</span><span> </span><span class="hs-identifier">QUOTE</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679134465"><span class="hs-operator hs-var">&lt;$&gt;</span></a><span> </span><span class="hs-identifier">pres_pecs</span><span class="hs-special">)</span><span> </span><span class="hs-comment">--61 is '='</span><span>
</span><a name="line-726"></a><span>      </span><a name="local-6989586621679134467"><a href="#local-6989586621679134467"><span class="hs-identifier">specsMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.fromList</span><span> </span><a href="#local-6989586621679134466"><span class="hs-identifier hs-var">specs</span></a><span>
</span><a name="line-727"></a><span>  </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-728"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-729"></a><span>        </span><a href="ClickHouseDriver.Core.Types.html#CKString"><span class="hs-identifier hs-var">CKString</span></a><span> </span><a name="local-6989586621679134472"><a href="#local-6989586621679134472"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-730"></a><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-string">&quot;Enum8&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679134461"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-731"></a><span>              </span><span class="hs-keyword">then</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt8"><span class="hs-identifier hs-var">writeBinaryInt8</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679134467"><span class="hs-identifier hs-var">specsMap</span></a><span> </span><span class="hs-operator hs-var">Map.!</span><span> </span><a href="#local-6989586621679134472"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-732"></a><span>              </span><span class="hs-keyword">else</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt16"><span class="hs-identifier hs-var">writeBinaryInt16</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679134467"><span class="hs-identifier hs-var">specsMap</span></a><span> </span><span class="hs-operator hs-var">Map.!</span><span> </span><a href="#local-6989586621679134472"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-733"></a><span>          </span><span class="hs-special">)</span><span>
</span><a name="line-734"></a><span>        </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-735"></a><span>          </span><span class="hs-keyword">if</span><span> </span><span class="hs-string">&quot;Enum8&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679134461"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-736"></a><span>            </span><span class="hs-keyword">then</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt8"><span class="hs-identifier hs-var">writeBinaryInt8</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-737"></a><span>            </span><span class="hs-keyword">else</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt16"><span class="hs-identifier hs-var">writeBinaryInt16</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-738"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679134460"><span class="hs-identifier hs-var">col_name</span></a><span>
</span><a name="line-739"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-740"></a><span>    </span><a href="#local-6989586621679134462"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-741"></a><span>
</span><a name="line-742"></a><span class="hs-comment">----------------------------------------------------------------------</span><span>
</span><a name="line-743"></a><span class="hs-identifier">readDate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-744"></a><a name="readDate"><a href="ClickHouseDriver.Core.Column.html#readDate"><span class="hs-identifier">readDate</span></a></a><span> </span><a name="local-6989586621679134473"><a href="#local-6989586621679134473"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-745"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134474"><a href="#local-6989586621679134474"><span class="hs-identifier">epoch_start</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromGregorian</span><span> </span><span class="hs-number">1970</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-746"></a><span>  </span><a name="local-6989586621679134475"><a href="#local-6989586621679134475"><span class="hs-identifier">days</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679134473"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt16"><span class="hs-identifier hs-var">readBinaryUInt16</span></a><span>
</span><a name="line-747"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134476"><a href="#local-6989586621679134476"><span class="hs-identifier">dates</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679134479"><a href="#local-6989586621679134479"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">addDays</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679134479"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679134474"><span class="hs-identifier hs-var">epoch_start</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679134475"><span class="hs-identifier hs-var">days</span></a><span>
</span><a name="line-748"></a><span>      </span><a name="local-6989586621679134477"><a href="#local-6989586621679134477"><span class="hs-identifier">toTriple</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.map</span><span> </span><span class="hs-identifier hs-var">toGregorian</span><span> </span><a href="#local-6989586621679134476"><span class="hs-identifier hs-var">dates</span></a><span>
</span><a name="line-749"></a><span>      </span><a name="local-6989586621679134478"><a href="#local-6989586621679134478"><span class="hs-identifier">toCK</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679134610"><a href="#local-6989586621679134610"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134611"><a href="#local-6989586621679134611"><span class="hs-identifier">m</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134612"><a href="#local-6989586621679134612"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.Core.Types.html#CKDate"><span class="hs-identifier hs-var">CKDate</span></a><span> </span><a href="#local-6989586621679134610"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621679134611"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679134612"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679134477"><span class="hs-identifier hs-var">toTriple</span></a><span>
</span><a name="line-750"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679134478"><span class="hs-identifier hs-var">toCK</span></a><span>
</span><a name="line-751"></a><span>
</span><a name="line-752"></a><span class="hs-identifier">writeDate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-753"></a><a name="writeDate"><a href="ClickHouseDriver.Core.Column.html#writeDate"><span class="hs-identifier">writeDate</span></a></a><span> </span><a name="local-6989586621679134613"><a href="#local-6989586621679134613"><span class="hs-identifier">col_name</span></a></a><span> </span><a name="local-6989586621679134614"><a href="#local-6989586621679134614"><span class="hs-identifier">items</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-754"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134615"><a href="#local-6989586621679134615"><span class="hs-identifier">epoch_start</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromGregorian</span><span> </span><span class="hs-number">1970</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-755"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134616"><a href="#local-6989586621679134616"><span class="hs-identifier">serialize</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-756"></a><span>        </span><span class="hs-identifier hs-var">V.map</span><span>
</span><a name="line-757"></a><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-758"></a><span>              </span><a href="ClickHouseDriver.Core.Types.html#CKDate"><span class="hs-identifier hs-var">CKDate</span></a><span> </span><a name="local-6989586621679134617"><a href="#local-6989586621679134617"><span class="hs-identifier">y</span></a></a><span> </span><a name="local-6989586621679134618"><a href="#local-6989586621679134618"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679134619"><a href="#local-6989586621679134619"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">diffDays</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromGregorian</span><span> </span><a href="#local-6989586621679134617"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621679134618"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679134619"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679134615"><span class="hs-identifier hs-var">epoch_start</span></a><span>
</span><a name="line-759"></a><span>              </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-760"></a><span>                </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-761"></a><span>                  </span><span class="hs-string">&quot;unexpected type in the column: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134613"><span class="hs-identifier hs-var">col_name</span></a><span>
</span><a name="line-762"></a><span>                    </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; whose type should be Date&quot;</span><span>
</span><a name="line-763"></a><span>          </span><span class="hs-special">)</span><span>
</span><a name="line-764"></a><span>          </span><a href="#local-6989586621679134614"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-765"></a><span>  </span><span class="hs-identifier hs-var">V.mapM_</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt16"><span class="hs-identifier hs-var">writeBinaryInt16</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679134616"><span class="hs-identifier hs-var">serialize</span></a><span>
</span><a name="line-766"></a><span>
</span><a name="line-767"></a><span class="hs-comment">--------------------------------------------------------------------------------------</span><span>
</span><a name="line-768"></a><span class="hs-identifier">readDecimal</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-769"></a><a name="readDecimal"><a href="ClickHouseDriver.Core.Column.html#readDecimal"><span class="hs-identifier">readDecimal</span></a></a><span> </span><a name="local-6989586621679134620"><a href="#local-6989586621679134620"><span class="hs-identifier">n_rows</span></a></a><span> </span><a name="local-6989586621679134621"><a href="#local-6989586621679134621"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-770"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134638"><a href="#local-6989586621679134638"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679134621"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-771"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134639"><a href="#local-6989586621679134639"><span class="hs-identifier">inner_spec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#getSpecs"><span class="hs-identifier hs-var">getSpecs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134638"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">9</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">8</span><span> </span><a href="#local-6989586621679134621"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-772"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679134640"><a href="#local-6989586621679134640"><span class="hs-identifier">specific</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679134641"><a href="#local-6989586621679134641"><span class="hs-identifier">scale</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679134639"><span class="hs-identifier hs-var">inner_spec</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-773"></a><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;No spec&quot;</span><span>
</span><a name="line-774"></a><span>        </span><span class="hs-special">[</span><a name="local-6989586621679134642"><a href="#local-6989586621679134642"><span class="hs-identifier">scale'</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-775"></a><span>          </span><span class="hs-keyword">if</span><span> </span><span class="hs-string">&quot;Decimal32&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679134621"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-776"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134622"><span class="hs-identifier hs-var">readDecimal32</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679134642"><span class="hs-identifier hs-var">scale'</span></a><span class="hs-special">)</span><span>
</span><a name="line-777"></a><span>            </span><span class="hs-keyword">else</span><span>
</span><a name="line-778"></a><span>              </span><span class="hs-keyword">if</span><span> </span><span class="hs-string">&quot;Decimal64&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679134621"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-779"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134623"><span class="hs-identifier hs-var">readDecimal64</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679134642"><span class="hs-identifier hs-var">scale'</span></a><span class="hs-special">)</span><span>
</span><a name="line-780"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134624"><span class="hs-identifier hs-var">readDecimal128</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679134642"><span class="hs-identifier hs-var">scale'</span></a><span class="hs-special">)</span><span>
</span><a name="line-781"></a><span>        </span><span class="hs-special">[</span><a name="local-6989586621679134643"><a href="#local-6989586621679134643"><span class="hs-identifier">precision'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134644"><a href="#local-6989586621679134644"><span class="hs-identifier">scale'</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-782"></a><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679134645"><a href="#local-6989586621679134645"><span class="hs-identifier">precision</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679134643"><span class="hs-identifier hs-var">precision'</span></a><span>
</span><a name="line-783"></a><span>          </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679134645"><span class="hs-identifier hs-var">precision</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">9</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-string">&quot;Decimal32&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679134621"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-784"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134622"><span class="hs-identifier hs-var">readDecimal32</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679134644"><span class="hs-identifier hs-var">scale'</span></a><span class="hs-special">)</span><span>
</span><a name="line-785"></a><span>            </span><span class="hs-keyword">else</span><span>
</span><a name="line-786"></a><span>              </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679134645"><span class="hs-identifier hs-var">precision</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">18</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-string">&quot;Decimal64&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679134621"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-787"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134623"><span class="hs-identifier hs-var">readDecimal64</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679134644"><span class="hs-identifier hs-var">scale'</span></a><span class="hs-special">)</span><span>
</span><a name="line-788"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134624"><span class="hs-identifier hs-var">readDecimal128</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679134644"><span class="hs-identifier hs-var">scale'</span></a><span class="hs-special">)</span><span>
</span><a name="line-789"></a><span>  </span><a name="local-6989586621679134646"><a href="#local-6989586621679134646"><span class="hs-identifier">raw</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679134640"><span class="hs-identifier hs-var">specific</span></a><span> </span><a href="#local-6989586621679134620"><span class="hs-identifier hs-var">n_rows</span></a><span>
</span><a name="line-790"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134647"><a href="#local-6989586621679134647"><span class="hs-identifier">final</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134625"><span class="hs-identifier hs-var">trans</span></a><span> </span><a href="#local-6989586621679134641"><span class="hs-identifier hs-var">scale</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679134646"><span class="hs-identifier hs-var">raw</span></a><span>
</span><a name="line-791"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679134647"><span class="hs-identifier hs-var">final</span></a><span>
</span><a name="line-792"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-793"></a><span>    </span><span class="hs-identifier">readDecimal32</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-794"></a><span>    </span><a name="local-6989586621679134622"><a href="#local-6989586621679134622"><span class="hs-identifier">readDecimal32</span></a></a><span> </span><a name="local-6989586621679134626"><a href="#local-6989586621679134626"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readIntColumn"><span class="hs-identifier hs-var">readIntColumn</span></a><span> </span><a href="#local-6989586621679134626"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-string">&quot;Int32&quot;</span><span>
</span><a name="line-795"></a><span>
</span><a name="line-796"></a><span>    </span><span class="hs-identifier">readDecimal64</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-797"></a><span>    </span><a name="local-6989586621679134623"><a href="#local-6989586621679134623"><span class="hs-identifier">readDecimal64</span></a></a><span> </span><a name="local-6989586621679134627"><a href="#local-6989586621679134627"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#readIntColumn"><span class="hs-identifier hs-var">readIntColumn</span></a><span> </span><a href="#local-6989586621679134627"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-string">&quot;Int64&quot;</span><span>
</span><a name="line-798"></a><span>
</span><a name="line-799"></a><span>    </span><span class="hs-identifier">readDecimal128</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-800"></a><span>    </span><a name="local-6989586621679134624"><a href="#local-6989586621679134624"><span class="hs-identifier">readDecimal128</span></a></a><span> </span><a name="local-6989586621679134628"><a href="#local-6989586621679134628"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-801"></a><span>      </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679134628"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-802"></a><span>        </span><a name="local-6989586621679134629"><a href="#local-6989586621679134629"><span class="hs-identifier">lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt64"><span class="hs-identifier hs-var">readBinaryUInt64</span></a><span>
</span><a name="line-803"></a><span>        </span><a name="local-6989586621679134630"><a href="#local-6989586621679134630"><span class="hs-identifier">hi</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt64"><span class="hs-identifier hs-var">readBinaryUInt64</span></a><span>
</span><a name="line-804"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Types.html#CKUInt128"><span class="hs-identifier hs-var">CKUInt128</span></a><span> </span><a href="#local-6989586621679134629"><span class="hs-identifier hs-var">lo</span></a><span> </span><a href="#local-6989586621679134630"><span class="hs-identifier hs-var">hi</span></a><span>
</span><a name="line-805"></a><span>
</span><a name="line-806"></a><span>    </span><span class="hs-identifier">trans</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span>
</span><a name="line-807"></a><span>    </span><a name="local-6989586621679134625"><a href="#local-6989586621679134625"><span class="hs-identifier">trans</span></a></a><span> </span><a name="local-6989586621679134631"><a href="#local-6989586621679134631"><span class="hs-identifier">scale</span></a></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKInt32"><span class="hs-identifier hs-var">CKInt32</span></a><span> </span><a name="local-6989586621679134632"><a href="#local-6989586621679134632"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Types.html#CKDecimal32"><span class="hs-identifier hs-var">CKDecimal32</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679134632"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">/</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-number">10</span><span> </span><span class="hs-operator hs-var">^</span><span> </span><a href="#local-6989586621679134631"><span class="hs-identifier hs-var">scale</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-808"></a><span>    </span><span class="hs-identifier">trans</span><span> </span><a name="local-6989586621679134633"><a href="#local-6989586621679134633"><span class="hs-identifier">scale</span></a></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKInt64"><span class="hs-identifier hs-var">CKInt64</span></a><span> </span><a name="local-6989586621679134634"><a href="#local-6989586621679134634"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Types.html#CKDecimal64"><span class="hs-identifier hs-var">CKDecimal64</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679134634"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">/</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-number">10</span><span> </span><span class="hs-operator hs-var">^</span><span> </span><a href="#local-6989586621679134633"><span class="hs-identifier hs-var">scale</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-809"></a><span>    </span><span class="hs-identifier">trans</span><span> </span><a name="local-6989586621679134635"><a href="#local-6989586621679134635"><span class="hs-identifier">scale</span></a></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKUInt128"><span class="hs-identifier hs-var">CKUInt128</span></a><span> </span><a name="local-6989586621679134636"><a href="#local-6989586621679134636"><span class="hs-identifier">lo</span></a></a><span> </span><a name="local-6989586621679134637"><a href="#local-6989586621679134637"><span class="hs-identifier">hi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Types.html#CKDecimal128"><span class="hs-identifier hs-var">CKDecimal128</span></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Column.html#word128_division"><span class="hs-identifier hs-var">word128_division</span></a><span> </span><a href="#local-6989586621679134637"><span class="hs-identifier hs-var">hi</span></a><span> </span><a href="#local-6989586621679134636"><span class="hs-identifier hs-var">lo</span></a><span> </span><a href="#local-6989586621679134635"><span class="hs-identifier hs-var">scale</span></a><span class="hs-special">)</span><span>
</span><a name="line-810"></a><span>
</span><a name="line-811"></a><span class="hs-identifier">writeDecimal</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-812"></a><a name="writeDecimal"><a href="ClickHouseDriver.Core.Column.html#writeDecimal"><span class="hs-identifier">writeDecimal</span></a></a><span> </span><a name="local-6989586621679134648"><a href="#local-6989586621679134648"><span class="hs-identifier">col_name</span></a></a><span> </span><a name="local-6989586621679134649"><a href="#local-6989586621679134649"><span class="hs-identifier">spec</span></a></a><span> </span><a name="local-6989586621679134650"><a href="#local-6989586621679134650"><span class="hs-identifier">items</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-813"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134663"><a href="#local-6989586621679134663"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679134649"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-814"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134664"><a href="#local-6989586621679134664"><span class="hs-identifier">inner_specs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#getSpecs"><span class="hs-identifier hs-var">getSpecs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134663"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">9</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">8</span><span> </span><a href="#local-6989586621679134649"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-815"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679134665"><a href="#local-6989586621679134665"><span class="hs-identifier">specific</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679134666"><a href="#local-6989586621679134666"><span class="hs-identifier">pre_scale</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679134664"><span class="hs-identifier hs-var">inner_specs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-816"></a><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;No spec&quot;</span><span>
</span><a name="line-817"></a><span>        </span><span class="hs-special">[</span><a name="local-6989586621679134667"><a href="#local-6989586621679134667"><span class="hs-identifier">scale'</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-818"></a><span>          </span><span class="hs-keyword">if</span><span> </span><span class="hs-string">&quot;Decimal32&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679134649"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-819"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134651"><span class="hs-identifier hs-var">writeDecimal32</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679134667"><span class="hs-identifier hs-var">scale'</span></a><span class="hs-special">)</span><span>
</span><a name="line-820"></a><span>            </span><span class="hs-keyword">else</span><span>
</span><a name="line-821"></a><span>              </span><span class="hs-keyword">if</span><span> </span><span class="hs-string">&quot;Decimal64&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679134649"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-822"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134652"><span class="hs-identifier hs-var">writeDecimal64</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679134667"><span class="hs-identifier hs-var">scale'</span></a><span class="hs-special">)</span><span>
</span><a name="line-823"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134653"><span class="hs-identifier hs-var">writeDecimal128</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679134667"><span class="hs-identifier hs-var">scale'</span></a><span class="hs-special">)</span><span>
</span><a name="line-824"></a><span>        </span><span class="hs-special">[</span><a name="local-6989586621679134668"><a href="#local-6989586621679134668"><span class="hs-identifier">precision'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134669"><a href="#local-6989586621679134669"><span class="hs-identifier">scale'</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-825"></a><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679134670"><a href="#local-6989586621679134670"><span class="hs-identifier">precision</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679134668"><span class="hs-identifier hs-var">precision'</span></a><span>
</span><a name="line-826"></a><span>          </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679134670"><span class="hs-identifier hs-var">precision</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">9</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-string">&quot;Decimal32&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679134649"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-827"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134651"><span class="hs-identifier hs-var">writeDecimal32</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679134669"><span class="hs-identifier hs-var">scale'</span></a><span class="hs-special">)</span><span>
</span><a name="line-828"></a><span>            </span><span class="hs-keyword">else</span><span>
</span><a name="line-829"></a><span>              </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679134670"><span class="hs-identifier hs-var">precision</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">18</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-string">&quot;Decimal64&quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679134649"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-830"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134652"><span class="hs-identifier hs-var">writeDecimal64</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679134669"><span class="hs-identifier hs-var">scale'</span></a><span class="hs-special">)</span><span>
</span><a name="line-831"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134653"><span class="hs-identifier hs-var">writeDecimal128</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readInt</span><span> </span><a href="#local-6989586621679134669"><span class="hs-identifier hs-var">scale'</span></a><span class="hs-special">)</span><span>
</span><a name="line-832"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134671"><a href="#local-6989586621679134671"><span class="hs-identifier">scale</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">10</span><span> </span><span class="hs-operator hs-var">^</span><span> </span><a href="#local-6989586621679134666"><span class="hs-identifier hs-var">pre_scale</span></a><span>
</span><a name="line-833"></a><span>  </span><a href="#local-6989586621679134665"><span class="hs-identifier hs-var">specific</span></a><span> </span><a href="#local-6989586621679134671"><span class="hs-identifier hs-var">scale</span></a><span> </span><a href="#local-6989586621679134650"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-834"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-835"></a><span>    </span><span class="hs-identifier">writeDecimal32</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-836"></a><span>    </span><a name="local-6989586621679134651"><a href="#local-6989586621679134651"><span class="hs-identifier">writeDecimal32</span></a></a><span> </span><a name="local-6989586621679134654"><a href="#local-6989586621679134654"><span class="hs-identifier">scale</span></a></a><span> </span><a name="local-6989586621679134655"><a href="#local-6989586621679134655"><span class="hs-identifier">vec</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-837"></a><span>      </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-838"></a><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-839"></a><span>            </span><a href="ClickHouseDriver.Core.Types.html#CKDecimal32"><span class="hs-identifier hs-var">CKDecimal32</span></a><span> </span><a name="local-6989586621679134656"><a href="#local-6989586621679134656"><span class="hs-identifier">f32</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt32"><span class="hs-identifier hs-var">writeBinaryInt32</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">floor</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134656"><span class="hs-identifier hs-var">f32</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679134654"><span class="hs-identifier hs-var">scale</span></a><span class="hs-special">)</span><span>
</span><a name="line-840"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679134648"><span class="hs-identifier hs-var">col_name</span></a><span>
</span><a name="line-841"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-842"></a><span>        </span><a href="#local-6989586621679134655"><span class="hs-identifier hs-var">vec</span></a><span>
</span><a name="line-843"></a><span>    </span><span class="hs-identifier">writeDecimal64</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-844"></a><span>    </span><a name="local-6989586621679134652"><a href="#local-6989586621679134652"><span class="hs-identifier">writeDecimal64</span></a></a><span> </span><a name="local-6989586621679134657"><a href="#local-6989586621679134657"><span class="hs-identifier">scale</span></a></a><span> </span><a name="local-6989586621679134658"><a href="#local-6989586621679134658"><span class="hs-identifier">vec</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-845"></a><span>      </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-846"></a><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-847"></a><span>            </span><a href="ClickHouseDriver.Core.Types.html#CKDecimal64"><span class="hs-identifier hs-var">CKDecimal64</span></a><span> </span><a name="local-6989586621679134659"><a href="#local-6989586621679134659"><span class="hs-identifier">f64</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt32"><span class="hs-identifier hs-var">writeBinaryInt32</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">floor</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134659"><span class="hs-identifier hs-var">f64</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679134657"><span class="hs-identifier hs-var">scale</span></a><span class="hs-special">)</span><span>
</span><a name="line-848"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679134648"><span class="hs-identifier hs-var">col_name</span></a><span>
</span><a name="line-849"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-850"></a><span>        </span><a href="#local-6989586621679134658"><span class="hs-identifier hs-var">vec</span></a><span>
</span><a name="line-851"></a><span>    </span><span class="hs-identifier">writeDecimal128</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-852"></a><span>    </span><a name="local-6989586621679134653"><a href="#local-6989586621679134653"><span class="hs-identifier">writeDecimal128</span></a></a><span> </span><a name="local-6989586621679134660"><a href="#local-6989586621679134660"><span class="hs-identifier">scale</span></a></a><span> </span><a name="local-6989586621679134661"><a href="#local-6989586621679134661"><span class="hs-identifier">items</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-853"></a><span>      </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-854"></a><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-855"></a><span>            </span><a href="ClickHouseDriver.Core.Types.html#CKDecimal128"><span class="hs-identifier hs-var">CKDecimal128</span></a><span> </span><a name="local-6989586621679134662"><a href="#local-6989586621679134662"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-856"></a><span>              </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679134662"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-857"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-858"></a><span>                  </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt64"><span class="hs-identifier hs-var">writeBinaryUInt64</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Column.html#low_bits_128"><span class="hs-identifier hs-var">low_bits_128</span></a><span> </span><a href="#local-6989586621679134662"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679134660"><span class="hs-identifier hs-var">scale</span></a><span>
</span><a name="line-859"></a><span>                  </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt64"><span class="hs-identifier hs-var">writeBinaryUInt64</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Column.html#hi_bits_128"><span class="hs-identifier hs-var">hi_bits_128</span></a><span> </span><a href="#local-6989586621679134662"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679134660"><span class="hs-identifier hs-var">scale</span></a><span>
</span><a name="line-860"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-861"></a><span>                  </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt64"><span class="hs-identifier hs-var">writeBinaryUInt64</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Column.html#low_bits_negative_128"><span class="hs-identifier hs-var">low_bits_negative_128</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679134662"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679134660"><span class="hs-identifier hs-var">scale</span></a><span>
</span><a name="line-862"></a><span>                  </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt64"><span class="hs-identifier hs-var">writeBinaryUInt64</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Column.html#hi_bits_negative_128"><span class="hs-identifier hs-var">hi_bits_negative_128</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679134662"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679134660"><span class="hs-identifier hs-var">scale</span></a><span>
</span><a name="line-863"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-864"></a><span>        </span><a href="#local-6989586621679134661"><span class="hs-identifier hs-var">items</span></a><span>
</span><a name="line-865"></a><span>
</span><a name="line-866"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;bigint.h word128_division&quot;</span><span> </span><span class="hs-identifier">word128_division</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Double</span><span>
</span><a name="line-867"></a><span>
</span><a name="line-868"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;bigint.h low_bits_128&quot;</span><span> </span><span class="hs-identifier">low_bits_128</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-869"></a><span>
</span><a name="line-870"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;bigint.h hi_bits_128&quot;</span><span> </span><span class="hs-identifier">hi_bits_128</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-871"></a><span>
</span><a name="line-872"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;bigint.h low_bits_negative_128&quot;</span><span> </span><span class="hs-identifier">low_bits_negative_128</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-873"></a><span>
</span><a name="line-874"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;bigint.h hi_bits_negative_128&quot;</span><span> </span><span class="hs-identifier">hi_bits_negative_128</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word64</span><span>
</span><a name="line-875"></a><span class="hs-comment">----------------------------------------------------------------------------------------------</span><span>
</span><a name="line-876"></a><span class="hs-identifier">readIPv4</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-877"></a><a name="readIPv4"><a href="ClickHouseDriver.Core.Column.html#readIPv4"><span class="hs-identifier">readIPv4</span></a></a><span> </span><a name="local-6989586621679134672"><a href="#local-6989586621679134672"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679134672"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKIPv4"><span class="hs-identifier hs-var">CKIPv4</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">ip4ToOctets</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">IP4</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt32"><span class="hs-identifier hs-var">readBinaryUInt32</span></a><span class="hs-special">)</span><span>
</span><a name="line-878"></a><span>
</span><a name="line-879"></a><span class="hs-identifier">readIPv6</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-880"></a><a name="readIPv6"><a href="ClickHouseDriver.Core.Column.html#readIPv6"><span class="hs-identifier">readIPv6</span></a></a><span> </span><a name="local-6989586621679134673"><a href="#local-6989586621679134673"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679134673"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKIPv6"><span class="hs-identifier hs-var">CKIPv6</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">ip6ToWords</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">IP6</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt128"><span class="hs-identifier hs-var">readBinaryUInt128</span></a><span class="hs-special">)</span><span>
</span><a name="line-881"></a><span>
</span><a name="line-882"></a><span class="hs-identifier">writeIPv4</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-883"></a><a name="writeIPv4"><a href="ClickHouseDriver.Core.Column.html#writeIPv4"><span class="hs-identifier">writeIPv4</span></a></a><span> </span><a name="local-6989586621679134674"><a href="#local-6989586621679134674"><span class="hs-identifier">col_name</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-884"></a><span>  </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-885"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-886"></a><span>        </span><a href="ClickHouseDriver.Core.Types.html#CKIPv4"><span class="hs-identifier hs-var">CKIPv4</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679134675"><a href="#local-6989586621679134675"><span class="hs-identifier">w1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134676"><a href="#local-6989586621679134676"><span class="hs-identifier">w2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134677"><a href="#local-6989586621679134677"><span class="hs-identifier">w3</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134678"><a href="#local-6989586621679134678"><span class="hs-identifier">w4</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-887"></a><span>          </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt32"><span class="hs-identifier hs-var">writeBinaryUInt32</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-888"></a><span>            </span><span class="hs-identifier">unIP4</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-889"></a><span>              </span><span class="hs-identifier hs-var">ip4FromOctets</span><span> </span><a href="#local-6989586621679134675"><span class="hs-identifier hs-var">w1</span></a><span> </span><a href="#local-6989586621679134676"><span class="hs-identifier hs-var">w2</span></a><span> </span><a href="#local-6989586621679134677"><span class="hs-identifier hs-var">w3</span></a><span> </span><a href="#local-6989586621679134678"><span class="hs-identifier hs-var">w4</span></a><span>
</span><a name="line-890"></a><span>        </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryInt32"><span class="hs-identifier hs-var">writeBinaryInt32</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-891"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679134674"><span class="hs-identifier hs-var">col_name</span></a><span>
</span><a name="line-892"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-893"></a><span>
</span><a name="line-894"></a><span class="hs-identifier">writeIPv6</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-895"></a><a name="writeIPv6"><a href="ClickHouseDriver.Core.Column.html#writeIPv6"><span class="hs-identifier">writeIPv6</span></a></a><span> </span><a name="local-6989586621679134679"><a href="#local-6989586621679134679"><span class="hs-identifier">col_name</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-896"></a><span>  </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-897"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-898"></a><span>        </span><a href="ClickHouseDriver.Core.Types.html#CKIPv6"><span class="hs-identifier hs-var">CKIPv6</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679134680"><a href="#local-6989586621679134680"><span class="hs-identifier">w1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134681"><a href="#local-6989586621679134681"><span class="hs-identifier">w2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134682"><a href="#local-6989586621679134682"><span class="hs-identifier">w3</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134683"><a href="#local-6989586621679134683"><span class="hs-identifier">w4</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134684"><a href="#local-6989586621679134684"><span class="hs-identifier">w5</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134685"><a href="#local-6989586621679134685"><span class="hs-identifier">w6</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134686"><a href="#local-6989586621679134686"><span class="hs-identifier">w7</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134687"><a href="#local-6989586621679134687"><span class="hs-identifier">w8</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-899"></a><span>          </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt128"><span class="hs-identifier hs-var">writeBinaryUInt128</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-900"></a><span>            </span><span class="hs-identifier">unIP6</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-901"></a><span>              </span><span class="hs-identifier hs-var">ip6FromWords</span><span> </span><a href="#local-6989586621679134680"><span class="hs-identifier hs-var">w1</span></a><span> </span><a href="#local-6989586621679134681"><span class="hs-identifier hs-var">w2</span></a><span> </span><a href="#local-6989586621679134682"><span class="hs-identifier hs-var">w3</span></a><span> </span><a href="#local-6989586621679134683"><span class="hs-identifier hs-var">w4</span></a><span> </span><a href="#local-6989586621679134684"><span class="hs-identifier hs-var">w5</span></a><span> </span><a href="#local-6989586621679134685"><span class="hs-identifier hs-var">w6</span></a><span> </span><a href="#local-6989586621679134686"><span class="hs-identifier hs-var">w7</span></a><span> </span><a href="#local-6989586621679134687"><span class="hs-identifier hs-var">w8</span></a><span>
</span><a name="line-902"></a><span>        </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt64"><span class="hs-identifier hs-var">writeBinaryUInt64</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-903"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier hs-var">typeMismatchError</span></a><span> </span><a href="#local-6989586621679134679"><span class="hs-identifier hs-var">col_name</span></a><span>
</span><a name="line-904"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-905"></a><span>
</span><a name="line-906"></a><span class="hs-comment">----------------------------------------------------------------------------------------------</span><span>
</span><a name="line-907"></a><span class="hs-identifier">readSimpleAggregateFunction</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ServerInfo"><span class="hs-identifier hs-type">ServerInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-908"></a><a name="readSimpleAggregateFunction"><a href="ClickHouseDriver.Core.Column.html#readSimpleAggregateFunction"><span class="hs-identifier">readSimpleAggregateFunction</span></a></a><span> </span><a name="local-6989586621679134688"><a href="#local-6989586621679134688"><span class="hs-identifier">server_info</span></a></a><span> </span><a name="local-6989586621679134689"><a href="#local-6989586621679134689"><span class="hs-identifier">n_rows</span></a></a><span> </span><a name="local-6989586621679134690"><a href="#local-6989586621679134690"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-909"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134691"><a href="#local-6989586621679134691"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679134690"><span class="hs-identifier hs-var">spec</span></a><span>
</span><a name="line-910"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679134692"><a href="#local-6989586621679134692"><span class="hs-identifier">func</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134693"><a href="#local-6989586621679134693"><span class="hs-identifier">cktype</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="ClickHouseDriver.Core.Column.html#getSpecs"><span class="hs-identifier hs-var">getSpecs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">BS.take</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679134691"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">25</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BS.drop</span><span> </span><span class="hs-number">24</span><span> </span><a href="#local-6989586621679134690"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-911"></a><span>  </span><a href="ClickHouseDriver.Core.Column.html#readColumn"><span class="hs-identifier hs-var">readColumn</span></a><span> </span><a href="#local-6989586621679134688"><span class="hs-identifier hs-var">server_info</span></a><span> </span><a href="#local-6989586621679134689"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><a href="#local-6989586621679134693"><span class="hs-identifier hs-var">cktype</span></a><span>
</span><a name="line-912"></a><span class="hs-comment">----------------------------------------------------------------------------------------------</span><span>
</span><a name="line-913"></a><span class="hs-identifier">readUUID</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#Reader"><span class="hs-identifier hs-type">Reader</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-914"></a><a name="readUUID"><a href="ClickHouseDriver.Core.Column.html#readUUID"><span class="hs-identifier">readUUID</span></a></a><span> </span><a name="local-6989586621679134694"><a href="#local-6989586621679134694"><span class="hs-identifier">n_rows</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-915"></a><span>  </span><span class="hs-identifier hs-var">V.replicateM</span><span> </span><a href="#local-6989586621679134694"><span class="hs-identifier hs-var">n_rows</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-916"></a><span>    </span><a name="local-6989586621679134695"><a href="#local-6989586621679134695"><span class="hs-identifier">w2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt32"><span class="hs-identifier hs-var">readBinaryUInt32</span></a><span>
</span><a name="line-917"></a><span>    </span><a name="local-6989586621679134696"><a href="#local-6989586621679134696"><span class="hs-identifier">w1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt32"><span class="hs-identifier hs-var">readBinaryUInt32</span></a><span>
</span><a name="line-918"></a><span>    </span><a name="local-6989586621679134697"><a href="#local-6989586621679134697"><span class="hs-identifier">w3</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt32"><span class="hs-identifier hs-var">readBinaryUInt32</span></a><span>
</span><a name="line-919"></a><span>    </span><a name="local-6989586621679134698"><a href="#local-6989586621679134698"><span class="hs-identifier">w4</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="ClickHouseDriver.IO.BufferedReader.html#readBinaryUInt32"><span class="hs-identifier hs-var">readBinaryUInt32</span></a><span>
</span><a name="line-920"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-921"></a><span>      </span><a href="ClickHouseDriver.Core.Types.html#CKString"><span class="hs-identifier hs-var">CKString</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-922"></a><span>        </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-923"></a><span>          </span><span class="hs-identifier hs-var">UUID.toString</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">UUID.fromWords</span><span> </span><a href="#local-6989586621679134696"><span class="hs-identifier hs-var">w1</span></a><span> </span><a href="#local-6989586621679134695"><span class="hs-identifier hs-var">w2</span></a><span> </span><a href="#local-6989586621679134697"><span class="hs-identifier hs-var">w3</span></a><span> </span><a href="#local-6989586621679134698"><span class="hs-identifier hs-var">w4</span></a><span>
</span><a name="line-924"></a><span>
</span><a name="line-925"></a><span class="hs-identifier">writeUUID</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ClickHouseDriver.IO.BufferedWriter.html#Writer"><span class="hs-identifier hs-type">Writer</span></a><span> </span><span class="hs-identifier hs-type">Builder</span><span>
</span><a name="line-926"></a><a name="writeUUID"><a href="ClickHouseDriver.Core.Column.html#writeUUID"><span class="hs-identifier">writeUUID</span></a></a><span> </span><a name="local-6989586621679134699"><a href="#local-6989586621679134699"><span class="hs-identifier">col_name</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-927"></a><span>  </span><span class="hs-identifier hs-var">V.mapM_</span><span>
</span><a name="line-928"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-929"></a><span>        </span><a href="ClickHouseDriver.Core.Types.html#CKString"><span class="hs-identifier hs-var">CKString</span></a><span> </span><a name="local-6989586621679134700"><a href="#local-6989586621679134700"><span class="hs-identifier">uuid_str</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-930"></a><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">UUID.fromString</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">C8.unpack</span><span> </span><a href="#local-6989586621679134700"><span class="hs-identifier hs-var">uuid_str</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-931"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-932"></a><span>              </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-933"></a><span>                </span><span class="hs-string">&quot;UUID parsing error in the column&quot;</span><span>
</span><a name="line-934"></a><span>                  </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134699"><span class="hs-identifier hs-var">col_name</span></a><span>
</span><a name="line-935"></a><span>                  </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; wrong data: &quot;</span><span>
</span><a name="line-936"></a><span>                  </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134700"><span class="hs-identifier hs-var">uuid_str</span></a><span>
</span><a name="line-937"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679134701"><a href="#local-6989586621679134701"><span class="hs-identifier">uuid</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-938"></a><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679134702"><a href="#local-6989586621679134702"><span class="hs-identifier">w2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134703"><a href="#local-6989586621679134703"><span class="hs-identifier">w1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134704"><a href="#local-6989586621679134704"><span class="hs-identifier">w3</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679134705"><a href="#local-6989586621679134705"><span class="hs-identifier">w4</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">UUID.toWords</span><span> </span><a href="#local-6989586621679134701"><span class="hs-identifier hs-var">uuid</span></a><span>
</span><a name="line-939"></a><span>              </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt32"><span class="hs-identifier hs-var">writeBinaryUInt32</span></a><span> </span><a href="#local-6989586621679134703"><span class="hs-identifier hs-var">w1</span></a><span>
</span><a name="line-940"></a><span>              </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt32"><span class="hs-identifier hs-var">writeBinaryUInt32</span></a><span> </span><a href="#local-6989586621679134702"><span class="hs-identifier hs-var">w2</span></a><span>
</span><a name="line-941"></a><span>              </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt32"><span class="hs-identifier hs-var">writeBinaryUInt32</span></a><span> </span><a href="#local-6989586621679134704"><span class="hs-identifier hs-var">w3</span></a><span>
</span><a name="line-942"></a><span>              </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt32"><span class="hs-identifier hs-var">writeBinaryUInt32</span></a><span> </span><a href="#local-6989586621679134705"><span class="hs-identifier hs-var">w4</span></a><span>
</span><a name="line-943"></a><span>        </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-944"></a><span>          </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt64"><span class="hs-identifier hs-var">writeBinaryUInt64</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-945"></a><span>          </span><a href="ClickHouseDriver.IO.BufferedWriter.html#writeBinaryUInt64"><span class="hs-identifier hs-var">writeBinaryUInt64</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-946"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-947"></a><span>
</span><a name="line-948"></a><span class="hs-comment">----------------------------------------------------------------------------------------------</span><span>
</span><a name="line-949"></a><span class="hs-comment">---Helpers</span><span>
</span><a name="line-950"></a><span class="hs-cpp">#define COMMA 44
#define SPACE 32
</span><span>
</span><a name="line-953"></a><span class="hs-comment">-- | Get rid of commas and spaces</span><span>
</span><a name="line-954"></a><span class="hs-identifier">getSpecs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ByteString</span><span class="hs-special">]</span><span>
</span><a name="line-955"></a><a name="getSpecs"><a href="ClickHouseDriver.Core.Column.html#getSpecs"><span class="hs-identifier">getSpecs</span></a></a><span> </span><a name="local-6989586621679134706"><a href="#local-6989586621679134706"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.splitWith</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">COMMA</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">BS.filter</span><span> </span><span class="hs-special">(</span><span class="hs-operator">/=</span><span> </span><span class="hs-identifier">SPACE</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">str</span><span class="hs-special">)</span><span>
</span><a name="line-956"></a><span>
</span><a name="line-957"></a><span class="hs-identifier">transpose</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span>
</span><a name="line-958"></a><a name="transpose"><a href="ClickHouseDriver.Core.Column.html#transpose"><span class="hs-identifier">transpose</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679134707"><span class="hs-identifier hs-var">rotate</span></a><span>
</span><a name="line-959"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-960"></a><span>    </span><a name="local-6989586621679134707"><a href="#local-6989586621679134707"><span class="hs-identifier">rotate</span></a></a><span> </span><a name="local-6989586621679134708"><a href="#local-6989586621679134708"><span class="hs-identifier">matrix</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-961"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679134709"><a href="#local-6989586621679134709"><span class="hs-identifier">transposedList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">List.transpose</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">V.toList</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">V.toList</span><span> </span><a href="#local-6989586621679134708"><span class="hs-identifier hs-var">matrix</span></a><span class="hs-special">)</span><span>
</span><a name="line-962"></a><span>          </span><a name="local-6989586621679134710"><a href="#local-6989586621679134710"><span class="hs-identifier">toVector</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.fromList</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">V.fromList</span><span> </span><a href="#local-6989586621679134709"><span class="hs-identifier hs-var">transposedList</span></a><span>
</span><a name="line-963"></a><span>       </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679134710"><span class="hs-identifier hs-var">toVector</span></a><span>
</span><a name="line-964"></a><span>
</span><a name="line-965"></a><span class="hs-identifier">typeMismatchError</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-966"></a><a name="typeMismatchError"><a href="ClickHouseDriver.Core.Column.html#typeMismatchError"><span class="hs-identifier">typeMismatchError</span></a></a><span> </span><a name="local-6989586621679134866"><a href="#local-6989586621679134866"><span class="hs-identifier">col_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Type mismatch in the column &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134866"><span class="hs-identifier hs-var">col_name</span></a><span>
</span><a name="line-967"></a><span>
</span><a name="line-968"></a><span class="hs-comment">-- | print in format</span><span>
</span><a name="line-969"></a><span class="hs-identifier">putStrLn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-970"></a><a name="putStrLn"><a href="ClickHouseDriver.Core.Column.html#putStrLn"><span class="hs-identifier">putStrLn</span></a></a><span> </span><a name="local-6989586621679134867"><a href="#local-6989586621679134867"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">C8.putStrLn</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">BS.intercalate</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.map</span><span> </span><a href="#local-6989586621679134868"><span class="hs-identifier hs-var">to_str</span></a><span> </span><a href="#local-6989586621679134867"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-971"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-972"></a><span>    </span><span class="hs-identifier">to_str</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Vector</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-973"></a><span>    </span><a name="local-6989586621679134868"><a href="#local-6989586621679134868"><span class="hs-identifier">to_str</span></a></a><span> </span><a name="local-6989586621679134870"><a href="#local-6989586621679134870"><span class="hs-identifier">row</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.intercalate</span><span> </span><span class="hs-string">&quot;,&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.map</span><span> </span><a href="#local-6989586621679134869"><span class="hs-identifier hs-var">help</span></a><span> </span><a href="#local-6989586621679134870"><span class="hs-identifier hs-var">row</span></a><span>
</span><a name="line-974"></a><span>
</span><a name="line-975"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ClickHouseDriver.Core.Types.html#ClickhouseType"><span class="hs-identifier hs-type">ClickhouseType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span>
</span><a name="line-976"></a><span>    </span><a name="local-6989586621679134869"><a href="#local-6989586621679134869"><span class="hs-identifier">help</span></a></a><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKString"><span class="hs-identifier hs-var">CKString</span></a><span> </span><a name="local-6989586621679134871"><a href="#local-6989586621679134871"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679134871"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-977"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKDecimal64"><span class="hs-identifier hs-var">CKDecimal64</span></a><span> </span><a name="local-6989586621679134872"><a href="#local-6989586621679134872"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134872"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-978"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKDecimal32"><span class="hs-identifier hs-var">CKDecimal32</span></a><span> </span><a name="local-6989586621679134873"><a href="#local-6989586621679134873"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134873"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-979"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKDecimal"><span class="hs-identifier hs-var">CKDecimal</span></a><span> </span><a name="local-6989586621679134874"><a href="#local-6989586621679134874"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134874"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-980"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKInt8"><span class="hs-identifier hs-var">CKInt8</span></a><span> </span><a name="local-6989586621679134875"><a href="#local-6989586621679134875"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134875"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-981"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKInt16"><span class="hs-identifier hs-var">CKInt16</span></a><span> </span><a name="local-6989586621679134876"><a href="#local-6989586621679134876"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134876"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-982"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKInt32"><span class="hs-identifier hs-var">CKInt32</span></a><span> </span><a name="local-6989586621679134877"><a href="#local-6989586621679134877"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134877"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-983"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKInt64"><span class="hs-identifier hs-var">CKInt64</span></a><span> </span><a name="local-6989586621679134878"><a href="#local-6989586621679134878"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134878"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-984"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKUInt8"><span class="hs-identifier hs-var">CKUInt8</span></a><span> </span><a name="local-6989586621679134879"><a href="#local-6989586621679134879"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134879"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-985"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKUInt16"><span class="hs-identifier hs-var">CKUInt16</span></a><span> </span><a name="local-6989586621679134880"><a href="#local-6989586621679134880"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134880"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-986"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKUInt32"><span class="hs-identifier hs-var">CKUInt32</span></a><span> </span><a name="local-6989586621679134881"><a href="#local-6989586621679134881"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134881"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-987"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKUInt64"><span class="hs-identifier hs-var">CKUInt64</span></a><span> </span><a name="local-6989586621679134882"><a href="#local-6989586621679134882"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134882"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-988"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKTuple"><span class="hs-identifier hs-var">CKTuple</span></a><span> </span><a name="local-6989586621679134883"><a href="#local-6989586621679134883"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;(&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679134868"><span class="hs-identifier hs-var">to_str</span></a><span> </span><a href="#local-6989586621679134883"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-989"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKArray"><span class="hs-identifier hs-var">CKArray</span></a><span> </span><a name="local-6989586621679134884"><a href="#local-6989586621679134884"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;[&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679134868"><span class="hs-identifier hs-var">to_str</span></a><span> </span><a href="#local-6989586621679134884"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;]&quot;</span><span>
</span><a name="line-990"></a><span>    </span><span class="hs-identifier">help</span><span>  </span><a href="ClickHouseDriver.Core.Types.html#CKNull"><span class="hs-identifier hs-var">CKNull</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;null&quot;</span><span>
</span><a name="line-991"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKIPv4"><span class="hs-identifier hs-var">CKIPv4</span></a><span> </span><a name="local-6989586621679134885"><a href="#local-6989586621679134885"><span class="hs-identifier">ip4</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134885"><span class="hs-identifier hs-var">ip4</span></a><span>
</span><a name="line-992"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKIPv6"><span class="hs-identifier hs-var">CKIPv6</span></a><span> </span><a name="local-6989586621679134886"><a href="#local-6989586621679134886"><span class="hs-identifier">ip6</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134886"><span class="hs-identifier hs-var">ip6</span></a><span>
</span><a name="line-993"></a><span>    </span><span class="hs-identifier">help</span><span> </span><span class="hs-special">(</span><a href="ClickHouseDriver.Core.Types.html#CKDate"><span class="hs-identifier hs-var">CKDate</span></a><span> </span><a name="local-6989586621679134887"><a href="#local-6989586621679134887"><span class="hs-identifier">y</span></a></a><span> </span><a name="local-6989586621679134888"><a href="#local-6989586621679134888"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679134889"><a href="#local-6989586621679134889"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-994"></a><span>      </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134887"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-995"></a><span>        </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;-&quot;</span><span>
</span><a name="line-996"></a><span>        </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134888"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-997"></a><span>        </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;-&quot;</span><span>
</span><a name="line-998"></a><span>        </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">C8.pack</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679134889"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-999"></a></pre></body></html>